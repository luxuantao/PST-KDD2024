<?xml version="1.0" encoding="UTF-8"?>
<TEI xml:space="preserve" xmlns="http://www.tei-c.org/ns/1.0" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.tei-c.org/ns/1.0 https://raw.githubusercontent.com/kermitt2/grobid/master/grobid-home/schemas/xsd/Grobid.xsd"
 xmlns:xlink="http://www.w3.org/1999/xlink">
	<teiHeader xml:lang="en">
		<fileDesc>
			<titleStmt>
				<title level="a" type="main">Weak solutions for partial differential equations with source terms: Application to the shallow water equations</title>
			</titleStmt>
			<publicationStmt>
				<publisher/>
				<availability status="unknown"><licence/></availability>
				<date type="published" when="2010-02-21">21 February 2010</date>
			</publicationStmt>
			<sourceDesc>
				<biblStruct>
					<analytic>
						<author role="corresp">
							<persName><forename type="first">J</forename><surname>Murillo</surname></persName>
							<email>javier.murillo@unizar.es</email>
							<affiliation key="aff0">
								<orgName type="institution">Fluid Mechanics. C.P.S. University of Zaragoza</orgName>
								<address>
									<settlement>Zaragoza</settlement>
									<country key="ES">Spain</country>
								</address>
							</affiliation>
						</author>
						<author>
							<persName><forename type="first">P</forename><surname>García-Navarro</surname></persName>
							<affiliation key="aff0">
								<orgName type="institution">Fluid Mechanics. C.P.S. University of Zaragoza</orgName>
								<address>
									<settlement>Zaragoza</settlement>
									<country key="ES">Spain</country>
								</address>
							</affiliation>
						</author>
						<title level="a" type="main">Weak solutions for partial differential equations with source terms: Application to the shallow water equations</title>
					</analytic>
					<monogr>
						<imprint>
							<date type="published" when="2010-02-21">21 February 2010</date>
						</imprint>
					</monogr>
					<idno type="MD5">D59D746955129E5AD01BEBE282E2816D</idno>
					<idno type="DOI">10.1016/j.jcp.2010.02.016</idno>
					<note type="submission">Received 6 November 2009 Received in revised form 5 February 2010 Accepted 16 February 2010</note>
				</biblStruct>
			</sourceDesc>
		</fileDesc>
		<encodingDesc>
			<appInfo>
				<application version="0.7.3" ident="GROBID" when="2023-07-28T03:15+0000">
					<desc>GROBID - A machine learning software for extracting information from scholarly documents</desc>
					<ref target="https://github.com/kermitt2/grobid"/>
				</application>
			</appInfo>
		</encodingDesc>
		<profileDesc>
			<textClass>
				<keywords>35L65 65M06 65M12 76M12 76M20 Weak solutions Well-balanced approach Roe methods Energy dissipating solutions Stability region Wet/dry front Shallow water systems</keywords>
			</textClass>
			<abstract>
<div xmlns="http://www.tei-c.org/ns/1.0"><p>Weak solutions of problems with m equations with source terms are proposed using an augmented Riemann solver defined by m + 1 states instead of increasing the number of involved equations. These weak solutions use propagating jump discontinuities connecting the m + 1 states to approximate the Riemann solution. The average of the propagated waves in the computational cell leads to a reinterpretation of the Roe's approach and in the upwind treatment of the source term of Vázquez-Cendón. It is derived that the numerical scheme can not be formulated evaluating the physical flux function at the position of the initial discontinuities, as usually done in the homogeneous case. Positivity requirements over the values of the intermediate states are the only way to control the global stability of the method. Also it is shown that the definition of well-balanced equilibrium in trivial cases is not sufficient to provide correct results: it is necessary to provide discrete evaluations of the source term that ensure energy dissipating solutions when demanded. The one and two dimensional shallow water equations with source terms due to the bottom topography and friction are presented as case study. The stability region is shown to differ from the one defined for the case without source terms, and it can be derived that the appearance of negative values of the thickness of the water layer in the proximity of the wet/dry front is a particular case, of the wet/wet fronts. The consequence is a severe reduction in the magnitude of the allowable time step size if compared with the one obtained for the homogeneous case. Starting from this result, 1D and 2D numerical schemes are developed for both quadrilateral and triangular grids, enforcing conservation and positivity over the solution, allowing computationally efficient simulations by means of a reconstruction technique for the inner states of the weak solution that allows a recovery of the time step size.</p></div>
			</abstract>
		</profileDesc>
	</teiHeader>
	<text xml:lang="en">
		<body>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="1.">Introduction</head><p>There is a wide range of physical situations, such as flow in open channels and rivers, tsunami and flood modeling, that can be mathematically represented by first-order non-linear systems of partial differential equations, whose derivation involves an assumption of the shallow water type. With rare exceptions, the governing equations are hyperbolic. The system of equations in realistic shallow water models include source terms, that is, terms that are functions of the vector of unknowns.</p><p>For sometime it has been accepted that the discretization of source terms can be as challenging as that of the non-linear advection terms. It must be said that for most cases, even naive discretizations of the source terms work reasonably well, but there are some well documented situations in which only sophisticated schemes can perform adequately. When solving real problems one is likely to encounter all sorts of situations, with a high probability that naive schemes will compromise the quality and reliability of the solution.</p><p>When incorporating the presence of the source terms in a given specific finite volume scheme (Roe's scheme is used here) the main focus has been traditionally put on how the numerical scheme can be modified so that it maintains a discrete balance between flux and source terms. In the context of the discretization of hyperbolic systems of conservative laws a fundamental point has been to get schemes that satisfy the preservation of steady-states such as still water equilibrium in the context of the shallow water system. The difficulty to build such schemes was pointed out by several authors and led to the notion of well-balanced schemes <ref type="bibr" target="#b8">[9,</ref><ref type="bibr" target="#b9">10,</ref><ref type="bibr" target="#b14">15,</ref><ref type="bibr" target="#b18">[19]</ref><ref type="bibr" target="#b19">[20]</ref><ref type="bibr" target="#b20">[21]</ref>.</p><p>In this framework the development of robust and efficient explicit finite volume models of shallow water flow has been the matter of recent research in the computational hydraulics literature. A few efforts have been reported on the search for the best methods able to preserve the exact conservation property (C-property) <ref type="bibr" target="#b19">[20]</ref> in presence of flow over irregular geometries <ref type="bibr" target="#b3">[4,</ref><ref type="bibr" target="#b10">11]</ref>. When dealing with simulation problems that involve bed variations and transient flow over a dry bed, these flow features impose a heavier restriction than the classical Courant-Friedrichs-Lewy (CFL) condition <ref type="bibr" target="#b5">[6,</ref><ref type="bibr" target="#b8">9,</ref><ref type="bibr" target="#b18">19]</ref> on the time step size that may lead to inefficient computations. It is possible to avoid the necessity of reducing the time step and, at the same time, preventing instability and ensuring conservation at all times by a suitable flux difference redistribution <ref type="bibr" target="#b10">[11,</ref><ref type="bibr" target="#b12">13]</ref>.</p><p>It can be argued that the presence of source terms warrants the construction of new weak solutions appropriate to the nature of the equations, rather than the use of those constructed for the simple, homogeneous case. Even ensuring the discrete equilibrium formulated in well-balanced schemes, the direct application of the conclusions derived for the homogeneous case to cases with source terms leads to important difficulties. One of the most dramatic is the appearance of negative values of water depth, not only in wet/dry fronts, but also in initially wet/wet Riemann problems.</p><p>Gravity and friction are the main forces driving open channel flows. When using the shallow water model in hydraulic simulation, these forces participate in the dynamic equation as sources/sinks of momentum. In cases of steady shallow water flow with non-zero velocity, the discrete balance must be revisited <ref type="bibr" target="#b11">[12]</ref>.</p><p>George <ref type="bibr" target="#b6">[7]</ref> presented a well balanced augmented approximate Riemann solver for the extended one dimensional shallow water equations including in the original solution vector two new variables: momentum flux and bottom surface. The solver is well-balanced and maintains a large class of steady states by the use of a properly defined steady state wave: a stationary jump discontinuity in the Riemann solution that acts as a source term. The idea of a stationary jump discontinuity is adapted to the method proposed in this work where the original system is not enlarged. without modifying the original solution vector of conserved quantities (mass and momentum), we present augmented approximate Riemann solvers for the shallow water equations in the presence of a variable bottom surface and friction. They belong to the class of simple approximate solvers that use a set of propagating jump discontinuities, or waves, to approximate the true Riemann solution. Typically, a simple solver for a system of m conservation laws uses msuch discontinuities. We present a three wave solver for the 1D shallow water equations system (two equations) and a four wave solver for the 2D case (three equations). In this work we go back to the original ideas of Roe using the upwind discretization of the source terms proposed by Vázquez-Cendón <ref type="bibr" target="#b19">[20]</ref>.</p><p>The outline of the paper is as follows: the one dimensional discretization is described first, for a scalar equation with source terms in Section 2 and then, in Section 3, for the 1D shallow water equations, followed by its application to a selection of results to show its accuracy. In Section 4 the generalization to two dimensions, illustrated using triangular grids, is presented and again applied to the shallow water equations. The final section contains the conclusions derived from the work.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.">One dimensional scalar Riemann problems with source terms</head><p>The basic ideas underlying this work can be illustrated by examining the nonlinear scalar equation,</p><formula xml:id="formula_0">@u @t þ @f ðuÞ @x ¼ s;<label>ð1Þ</label></formula><p>where f(u) is a convex nonlinear function of u and s is a source term. From f(u) it is possible to find an advection, or transport velocity k:</p><formula xml:id="formula_1">k ¼ df du k ¼ kðuÞ:<label>ð2Þ</label></formula><p>We are interested in weak solutions of the Riemann Problem (hereafter RP) defined by the initial condition uðx;</p><formula xml:id="formula_2">0Þ ¼ u L if x &lt; 0; u R if x &gt; 0: &amp;<label>ð3Þ</label></formula><p>2.1. Numerical modelling</p><p>Weak solutions of the RP can be found using the integral form of <ref type="bibr" target="#b0">(1)</ref>. Given initial values u L ; u R ; a time interval [0, 1] and a space interval [ÀX, X] , with X sufficiently large, S &lt; X, with S the position of the fastest wave at t = 1, the exact solution u at time t = 1 satisfies the following conservation integral:</p><formula xml:id="formula_3">Z þX ÀX uðx; 1Þdx ¼ Xðu L þ u R Þ À ðf ðu R Þ À f ðu L ÞÞ þ Z 1 0 Z þX ÀX s dx dt:<label>ð4Þ</label></formula><p>In order to obtain a numerical solution of (1) the domain is divided in computational cells of constant size Dx: the interval of the ith cell is defined by ½x iÀ1=2 ; x iþ1=2 . Let Dt be the time step and t n ¼ nDt a generic time level. Assuming the usual notation we indicate with u n i the cell-average value of the solution uðx; tÞ for the ith cell at time t n :</p><formula xml:id="formula_4">u n i ¼ 1 Dx Z x iþ1=2</formula><p>x iÀ1=2 uðx; t n Þdx; ð5Þ</p><p>u n i is therefore a piecewise approximation of the solution at time t n . The first order Godunov method, updates the averaged quantities one time-step assuming the following piecewise constant approximation, uðx; 0Þ ¼ u i if x &lt; 0;</p><formula xml:id="formula_5">u iþ1 if x &gt; 0; &amp;<label>ð6Þ</label></formula><p>at each cell edge. The solution of the RP is evolved for a time equal to the time step and the resulting solution is cell-averaged again obtaining the piecewise solution at the new time level t nþ1 . In the Roe approach, the solution of each RP is obtained from the exact solution of a locally linearized problem defined by an approximate solution ûðx; tÞ. The approximate solution must fulfill the Consistency Condition <ref type="bibr" target="#b8">[9]</ref> where the integral of the approximate solution ûðx; tÞ of the linearized RP over a suitable control volume is equal to the integral of the exact solution over the same control volume. In our case the control volume is characterized by the cell size, ÀDx</p><formula xml:id="formula_6">2 ; Dx 2 Â Ã , leading to Z Dx 2 ÀDx 2 ûðx; 1Þdx ¼ Dx ðu iþ1 þ u i Þ À ðf ðu iþ1 Þ À f ðu i ÞÞ þ Z 1 0 Z Dx 2 ÀDx 2 s dxdt:<label>ð7Þ</label></formula><p>Furthermore, as the source term s is not constant in time, we assume the following time linearization:</p><formula xml:id="formula_7">s iþ1=2 ¼ Z Dx 2 ÀDx 2 sðx; 0Þ dx:<label>ð8Þ</label></formula><p>Now, the Roe's approximate solution is constructed defining the following linear RP:</p><formula xml:id="formula_8">@û @t þ k Ã ðu iþ1 ; u i Þ @û @x ¼ 0; ûðx; 0Þ ¼ u i if x &lt; 0; u iþ1 if x &gt; 0; &amp;<label>ð9Þ</label></formula><p>where k Ã ðu iþ1 ; u i Þ is a constant. Integrating over the same control volume as in ( <ref type="formula" target="#formula_6">7</ref>)</p><formula xml:id="formula_9">Z Dx 2 ÀDx 2 ûðx; 1Þdx ¼ Dxðu iþ1 þ u i Þ À k Ã iþ1=2 ðu iþ1 À u i Þ:<label>ð10Þ</label></formula><p>Since we want to satisfy <ref type="bibr" target="#b6">(7)</ref>, the constraint that follows is:</p><formula xml:id="formula_10">ðdf À sÞ iþ1=2 ¼ f ðu iþ1 Þ À f ðu i Þ À s iþ1=2 ¼ k Ã iþ1=2 ðu iþ1 À u i Þ ð<label>11Þ</label></formula><p>leading to the following equality</p><formula xml:id="formula_11">k Ã iþ1=2 ¼ kiþ1=2 h iþ1=2 ;<label>ð12Þ</label></formula><formula xml:id="formula_12">with kiþ1=2 ¼ f ðu iþ1 Þ À f ðu i Þ u iþ1 À u i ; h iþ1=2 ¼ 1 À s iþ1=2 f ðu iþ1 Þ À f ðu i Þ ;<label>ð13Þ</label></formula><p>where k is the advection velocity when the source term s is not present and h is a measure of the relative importance of the source terms over the advective part.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.1.1.">A two wave approximate Riemann solution</head><p>A weak solution of the linear RP in (9) that satisfies <ref type="bibr" target="#b9">(10)</ref> in the case kiþ1=2 &gt; 0 is proposed:</p><formula xml:id="formula_13">ûðx; tÞ ¼ u i if x &lt; 0; u ÃÃ iþ1 if 0 &lt; x &lt; kiþ1=2 t; u iþ1 if x &gt; kiþ1=2 t; 8 &gt; &lt; &gt; :<label>ð14Þ</label></formula><p>where one wave is associated to the celerity k and the other wave is steady and with</p><formula xml:id="formula_14">u ÃÃ iþ1 ¼ u iþ1 À ðhduÞ iþ1=2 ¼ u i þ s k iþ1=2 :<label>ð15Þ</label></formula><p>Fig. <ref type="figure" target="#fig_5">1</ref> shows a sketch of the approximate solution in the particular case kiþ1=2 &gt; 0; u iþ1 &gt; u i and s iþ1=2 &lt; 0.</p><p>In case that kiþ1=2 &lt; 0 the proposed solution is:</p><formula xml:id="formula_15">ûðx; tÞ ¼ u i if x &lt; kiþ1=2 t; u Ã i if kiþ1=2 t &lt; x &lt; 0; u iþ1 if x &gt; 0; 8 &gt; &lt; &gt; :<label>ð16Þ</label></formula><formula xml:id="formula_16">with u Ã i ¼ u i þ ðhduÞ iþ1=2 ¼ u iþ1 À s k iþ1=2 :<label>ð17Þ</label></formula><p>These solutions are then evolved for a time equal to the time step; the resulting solution is cell-averaged again obtaining the piecewise solution at the new time level t nþ1 . Assuming that kiÀ1=2 &gt; 0 and kiþ1=2 &lt; 0, the volume integral in the cell ½0; Dx Â ½0; Dt represented in Fig. <ref type="figure" target="#fig_35">2</ref> is:</p><formula xml:id="formula_17">u nþ1 i Dx ¼ u ÃÃ i ð kiÀ1=2 DtÞ þ u n i ðDx À kiÀ1=2 Dt þ kiþ1=2 DtÞ À u Ã i ð kiþ1=2 DtÞ;<label>ð18Þ</label></formula><p>that can be rewritten as </p><formula xml:id="formula_18">u nþ1 i ¼ u n i À ððduh kÞ iÀ1=2 þ ðduh kÞ iþ1=2 Þ Dt Dx :<label>ð19Þ</label></formula><p>In Fig. <ref type="figure" target="#fig_35">2</ref> the time step is taken small enough so that there is no interaction of waves from neighboring Riemann problems. This would be necessary if we wanted to construct the solution at u nþ1 i in order to explicitly calculate the cell average <ref type="bibr" target="#b17">(18)</ref>. According to <ref type="bibr" target="#b8">[9]</ref>, in order to use the flux formula <ref type="bibr" target="#b18">(19)</ref> it is only necessary that the edge value ûðx; tÞ remains constant in time over the entire time step, which allows a time step roughly twice as large. Then, stability is ensured if the time step is limited by:</p><formula xml:id="formula_19">Dt 6 Dt k; Dt k ¼ Dx j kj<label>ð20Þ</label></formula><p>and the numerical scheme can be formulated in a general way as:</p><formula xml:id="formula_20">u nþ1 i ¼ u n i À ððdf À sÞ þ iÀ1=2 þ ðdf À sÞ À iþ1=2 Þ Dt Dx ; ðdf À sÞ AE iþ1=2 ¼ kAE hdu iþ1=2 :<label>ð21Þ</label></formula><p>Straightforward algebraic manipulation converts <ref type="bibr" target="#b20">(21)</ref> to an equivalent numerical flux-based finite volume scheme <ref type="bibr" target="#b7">[8]</ref>,</p><formula xml:id="formula_21">u nþ1 i ¼ u n i À f Ã iþ1=2 À f Ã iÀ1=2 Dt Dx þ s À iþ1=2 þ s þ iÀ1=2 Dt Dx<label>ð22Þ</label></formula><p>in which the numerical flux (denoted by an asterisk) for first-order upwinding is given by</p><formula xml:id="formula_22">f Ã iþ1=2 ¼ 1 2 ðf iþ1 þ f i Þ À 1 2 ðj kjduÞ iþ1=2 ;<label>ð23Þ</label></formula><p>with a similar expression for f Ã iÀ1=2 , and</p><formula xml:id="formula_23">s AE iþ1=2 ¼ 1 2 ð1 AE sgnð kÞÞ iþ1=2 s iþ1=2 :<label>ð24Þ</label></formula><p>These are essentially the two ways of extracting approximate information from the solution of the Riemann problem used in Godunov-type methods: one approach is, following Godunov's original method, to use the Riemann solutions to determine cell intermediate fluxes at each time step as in (23); the other approach is based on the wave propagation algorithm in which waves arising in Riemann solutions are directly re-averaged onto adjacent cells in order to update the numerical solution as in <ref type="bibr" target="#b20">(21)</ref>. The second is applicable to equations in the form of a conservation law as well as those where there is not a flux function (non-conservative equations). Therefore, it is the latter route the one we follow in this work together with the new idea that the presence of the source term generates more than one intermediate state.</p><p>When u n i P 0 in all computational cells and positivity over the updated solutions is required, u nþ1 i P 0, the limit for the time step size in <ref type="bibr" target="#b19">(20)</ref> is valid only if u Ã i &gt; 0 and u ÃÃ i &gt; 0 is guaranteed. Otherwise, it is necessary to define additional restrictions over the cell average, isolating the contributions of each independent RP.</p><p>Then, with reference to Fig. <ref type="figure" target="#fig_5">1</ref>, in the case u ÃÃ iþ1 6 0 at a i þ 1=2 edge, the time step must be redefined ensuring positivity on the cell average value in the control volume 0; 1  2 Dx</p><formula xml:id="formula_24">Â Ã ð kiþ1=2 DtÞu ÃÃ iþ1 þ 1 2 Dx À kiþ1=2 Dt u n iþ1 P 0<label>ð25Þ</label></formula><p>leading to the following limit in the size of the time step</p><formula xml:id="formula_25">Dt 6 Dt ÃÃ ; Dt ÃÃ ¼ 1 2 Dx e k iþ1=2 u n iþ1 u n iþ1 À u ÃÃ iþ1 :<label>ð26Þ</label></formula><p>In case that u Ã iþ1 6 0 at a i þ 1=2 edge, the limit is given by:</p><formula xml:id="formula_26">Dt 6 Dt Ã ; Dt Ã ¼ 1 2 Dx j k1 iþ1=2 j u n i u n i À u Ã i :<label>ð27Þ</label></formula><p>It is worth noting that if u n iþ1 ¼ 0 and u ÃÃ i &lt; 0 or if u n i ¼ 0 and u Ã i &lt; 0 the time step becomes nil according to (26) and to (27) respectively. Then, to ensure positivity of the solution in all cases the Godunov's method for the scalar case is formulated as follows:</p><formula xml:id="formula_27">u nþ1 i ¼ u n i À ððdf À sÞ þ iÀ1=2 þ ðdf À sÞ À iþ1=2 Þ Dt Dx ;<label>ð28Þ</label></formula><p>where the fluxes in a general intercell edge i þ 1=2 are computed as follows:</p><formula xml:id="formula_28">If u n iþ1 ¼ 0 and u ÃÃ iþ1 &lt; 0 set: ðdf À sÞ À iþ1=2 ¼ 0; ðdf À sÞ þ iþ1=2 ¼ 0:<label>ð29Þ</label></formula><formula xml:id="formula_29">If u n i ¼ 0 and u Ã i &lt; 0 set: ðdf À sÞ þ iþ1=2 ¼ 0 ðdf À sÞ À iþ1=2 ¼ 0:<label>ð30Þ</label></formula><p>Otherwise set:</p><formula xml:id="formula_30">ðdf À sÞ AE iþ1=2 ¼ ð kAE hduÞ iþ1=2 ;<label>ð31Þ</label></formula><formula xml:id="formula_31">with kAE iþ1=2 ¼ 1 2 ð k AE j kjÞ:<label>ð32Þ</label></formula><p>In consequence the stability region becomes:</p><formula xml:id="formula_32">Dt 6 minðDt ÃÃ ; Dt Ã ; Dt kÞ;<label>ð33Þ</label></formula><p>where Dt ÃÃ is defined as in (26) if u ÃÃ iþ1 &lt; 0 and u n iþ1 -0 and Dt Ã is defined as in (27) if u Ã i &lt; 0 and u n i -0. Depending on the particular approach chosen to discretize the integral source term s iþ1=2 the numerical scheme provides different solutions. The criterion to decide what is the best option for the source term discretization must be guided by the knowledge of the weak solution properties. This will be illustrated later with examples.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.2.">Application to the Burgers' equation with source terms</head><p>Consider Burgers' equation including source terms as proposed in <ref type="bibr" target="#b10">[11]</ref>:</p><formula xml:id="formula_33">@u @t þ 1 2 @u 2 @x ¼ Àu @z @x ;<label>ð34Þ</label></formula><p>with the initial data uðx;</p><formula xml:id="formula_34">0Þ ¼ u o ðxÞ ¼ u L if x &lt; 0; u R if x &gt; 0; &amp; zðxÞ ¼ z L if x &lt; 0; z R if x &gt; 0: &amp;<label>ð35Þ</label></formula><p>The exact solution to this problem is provided in Appendix A.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="2.2.1.">Numerical tests. Source term integration</head><p>In this section several RP solutions for Eq. (34) will be studied, analysing the evolution of the solution depending on the integration of the source term s iþ1=2 in (8). The cases are summarized in Table <ref type="table" target="#tab_0">1</ref>. All cases are computed using Dx ¼ 1 and CFL = 1. Numerical solutions will be performed using numerical schemes ( <ref type="formula" target="#formula_21">22</ref>) and (28) and the following approximate celerity k:</p><formula xml:id="formula_35">kiþ1=2 ¼ ðu iþ1 þ u i Þ 2 :<label>ð36Þ</label></formula><p>Depending on the approach applied to integrate the discontinuous source term s iþ1=2 different solutions appear. Their properties will be stated from comparison with known exact solutions in order to select the best option. Three approaches for s iþ1=2 will be checked. The first approach for s iþ1=2 ; s a iþ1=2 , is constructed enforcing equilibrium in steady states:</p><formula xml:id="formula_36">s a iþ1=2 ¼ À 1 2 ðu iþ1 þ u i Þðz iþ1 À z i Þ:<label>ð37Þ</label></formula><p>Two alternative approximations that do not enforce discrete equilibrium are also defined for numerical discussion: </p><formula xml:id="formula_37">s b iþ1=2 ¼ Àu iþ1 ðz iþ1 À z i Þ; s c iþ1=2 ¼ Àu i ðz iþ1 À z i Þ:<label>ð38Þ</label></formula><p>In test case 1 the exact solution is a right moving shock connecting u R with u Ã ¼ 1:5 with a celerity a = 1.25. Fig. <ref type="figure" target="#fig_1">3</ref>(a) shows the results given by the numerical scheme in (28) for approaches s a ; s b and s c . Function s a ðÀ ÀÞ provides an accurate value for u Ã , while s b ðÀ ÀÞ and s c ðÀMÀÞ overestimates and underestimates its value respectively, leading to a wrong shock velocity. In test case 2 the solution is a right moving shock connecting u R with u Ã ¼ 2:5 with a celerity a = 1.75. Also the function s a provides the best results, as depicted in Fig. <ref type="figure" target="#fig_1">3(b)</ref>. Approaches s b and s c lead to the same tendency as before.</p><p>Test cases 3 and 4 correspond to a right moving rarefaction wave. Fig. <ref type="figure" target="#fig_2">4</ref>(a) and (b) shows the results at t = 15 given by the numerical scheme in (28) for test cases 3 and 4, respectively, using the integral approach s a ; s b and s c . Although the approximate solution is constructed assuming only jumps, the rarefaction is satisfactorily computed when using approach s a in both cases, while s b ðÀ ÀÞ and s c ðÀMÀÞ overestimates and underestimates the value of u Ã L respectively. The good accordance among exact solutions and numerical results for approach s a can be explained attending to the result given by the approximate linear obtained when using this option, as in in this case the value of u ÃÃ iþ1 in <ref type="bibr" target="#b13">(14)</ref> becomes</p><formula xml:id="formula_38">u ÃÃ;a iþ1 ¼ u i À dz<label>ð39Þ</label></formula><p>equal to the analytical value for u Ã in the case of a shock wave (172) or equal to the analytical value for u Ã L in the case of a rarefaction (178).</p><p>In test case 5, u L &gt; u R , and for the homogeneous case, the solution is a shock wave. The presence of the source term leads to a rarefaction characterized by a value of u Ã L ¼ 0:5. Fig. <ref type="figure" target="#fig_3">5</ref>(a) shows the results at t = 15 using numerical scheme in (28), and how approach s a accurately reproduces the rarefaction wave. When using the approach s c where the solution becomes a stable rarefaction, defined from an incorrect value of u Ã L ¼ u ÃÃ;c iþ1 ¼ 0. If approach s b ðÀ ÀÞ is applied the initial solution becomes steady, as u iþ1 ¼ u ÃÃ;b iþ1 . In absence of exact solutions this would lead to the misleading conclusion that the result given by approach s b would be correct and the integral approach would be retained as a well balanced one.  The solution for test case 6 for the homogeneous case is a rarefaction wave, but the presence of the source term leads to a shock wave, defined by u Ã ¼ 2:5 Fig. <ref type="bibr">5(b)</ref> shows the results at t = 15 for numerical scheme in (28). Integral approach s a provides the most accurate solution while the integral approach s b leads to an overestimation of u Ã L . If approach s c is applied the initial solution becomes steady in time, as u iþ1 ¼ u ÃÃ;c iþ1 . Again, in absence of analytical solutions, the result given by approach s c may seem correct and would be retained as a well balanced approach.</p><p>In case 7, the initial conditions are defined to force null or negative values of ûðx; tÞ in the right side. The numerical solution must converge asymptotically to a stable rarefaction between u Ã L ¼ 0 and u R ¼ 2. When using numerical scheme in (22) with approach s a , negative values of u appear, as depicted in Fig. <ref type="figure" target="#fig_4">6(a)</ref>. Only the solution for approach s b remains positive, although an incorrect value of u Ã L is predicted. If, on the other hand, the scheme is carefully applied as in (28) the results improve as shown in Fig. <ref type="figure" target="#fig_4">6(b)</ref>. In this case both integral approaches s a and s c provide accurate and similar results, recovering the self-similarity of the problem. Approach s b provides the same results as before.</p><p>For test case 8 the right state u R is null, and the exact solution is a steady shock. If enforcing positivity over the solution, must remain steady and equal to the initial state. Fig. <ref type="figure" target="#fig_6">7</ref>(a) shows how when using numerical scheme in <ref type="bibr" target="#b20">(21)</ref> approaches s a and s c break the self similarity of the problem reaching negative values of u, while approach s b leads to a result that may seem reasonable, a right moving wave, but incorrect. The results for the numerical scheme in (28) are depicted in Fig. <ref type="figure" target="#fig_6">7</ref>(b), showing how both integral approaches s a and s c retain correctly the initial state, while integral approach s b provides the same incorrect results.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.">1D Systems of conservation laws with source terms</head><p>The discussion is next extended to hyperbolic nonlinear systems of equations with source terms in 1D, that expressed in integral formulation are:  where x 1 ; x 2 are the limits of a generic control volume. The differential formulation is obtained assuming smooth variation of the variables and an infinitesimal width of the control volume:</p><formula xml:id="formula_39">@ @t Z x 2 x 1 Udx þ Fj x 2 À Fj x1 À Z x 2 x 1 Sdx ¼ 0;<label>ð40Þ</label></formula><formula xml:id="formula_40">@U @t þ @F @x ¼ S<label>ð41Þ</label></formula><p>and from this formulation it is possible to define a Jacobian matrix for the convective part</p><formula xml:id="formula_41">J J ¼ dF dU :<label>ð42Þ</label></formula><p>Assuming that the convective part in (40) is strictly hyperbolic with two real eigenvalues k 1 ; k 2 and eigenvectors e 1 ; e 2 , it is possible define two matrices P ¼ ðe 1 ; e 2 Þ and P À1 with the property that they diagonalize the Jacobian J J ¼ PKP À1 : ð43Þ </p><p>and k min ; k max are the positions of the slowest and the fastest wave at t = 1, the solution U at time t = 1 satisfies the following property:</p><formula xml:id="formula_43">Z þX ÀX Uðx; 1Þ dx ¼ XðU R þ U L Þ À ðFðU R Þ À FðU L ÞÞ þ Z 1 0 Z þX ÀX S dx dt:<label>ð45Þ</label></formula><p>In order to obtain a numerical solution of system (41) we divide the domain in computational cells of constant size Dx: the interval of the ith cell is defined by ½x iÀ1=2 ; x iþ1=2 where x iþ1=2 ¼ iDx and the position of the center of the cell x i is defined by ði À 1=2ÞDx. Let Dt be the time step and t n ¼ nDt a generic time; assuming the usual notation we indicate with U n i the cellaverage value of the solution Uðx; tÞ for the ith cell at time t n :</p><formula xml:id="formula_44">U n i ¼ 1 Dx Z x iþ1=2 x iÀ1=2 Uðx; t n Þdx:<label>ð46Þ</label></formula><p>U n i is therefore a piecewise constant approximation of the solution at time t n . The first order Godunov method, provides a way to update the averaged quantities one time-step in the following way: the piecewise approximations (46), are considered as initial values of local RPs:</p><formula xml:id="formula_45">@U @t þ @F @x ðU i ; U iþ1 Þ ¼ SðU i ; U iþ1 Þ; Uðx; 0Þ ¼ U i if x &lt; 0; U iþ1 if x &gt; 0: &amp;<label>ð47Þ</label></formula><p>These RP solutions are then evolved for a time equal to the time step; the resulting solution is cell-averaged again obtaining the piecewise solution at the new time level t nþ1 . In the Roe approach, the solution of each RP is obtained from the exact solution of a locally linearized problem. This solution must fulfill the so called Consistency Condition, i.e. that the integral of the solution b Uðx; tÞ of the linearized RP over a suitable control volume must be equal to the integral of the exact solution of (47) over the same control volume. Using (45) this condition becomes:</p><formula xml:id="formula_46">Z þX ÀX b Uðx; 1Þ dx ¼ XðU iþ1 þ U i Þ À ðFðU iþ1 Þ À FðU i ÞÞ þ Z 1 0 Z þX ÀX S dx dt:<label>ð48Þ</label></formula><p>Since the source term is not necessarily constant in time, we assume the following time linearization of the Consistency Condition:</p><formula xml:id="formula_47">Z þX ÀX b Uðx; 1Þ dx ¼ XðU iþ1 þ U i Þ À ðFðU iþ1 Þ À FðU i Þ À S iþ1=2 Þ;<label>ð49Þ</label></formula><p>where</p><formula xml:id="formula_48">S iþ1=2 ¼ Z þX ÀX Sðx; 0Þ dx<label>ð50Þ</label></formula><p>is a suitable numerical source vector.</p><p>In this formulation, RP (47) is approximated by using the following linear RP:</p><formula xml:id="formula_49">@ b U @t þ J Ã @ b U @x ¼ 0; b Uðx; 0Þ ¼ U i if x &lt; 0; U iþ1 if x &gt; 0; &amp;<label>ð51Þ</label></formula><p>where</p><formula xml:id="formula_50">J Ã ðU i ; U iþ1 Þ is a constant matrix. Integrating (51) over the control volume [ÀX, X] Â [0, 1]</formula><p>, where X satisfies (44):</p><formula xml:id="formula_51">Z þX ÀX b Uðx; 1Þ dx ¼ XðU iþ1 þ U i Þ À J Ã ðU i ; U iþ1 Þ ðU iþ1 À U i Þ:<label>ð52Þ</label></formula><p>Since we want to satisfy (49), the constraint that follows is:</p><formula xml:id="formula_52">dF iþ1=2 À S iþ1=2 ¼ J Ã iþ1=2 dU iþ1=2 ;<label>ð53Þ</label></formula><formula xml:id="formula_53">with dF iþ1=2 ¼ FðU iþ1 Þ À FðU i Þ and dU iþ1=2 ¼ U iþ1 À U i</formula><p>Moreover, two more conditions are standard requirements for the Roe method.</p><formula xml:id="formula_54">J Ã iþ1=2 ðU iþ1 ; U i Þ; is diagonalizable with real eigenvalues J Ã iþ1=2 ðU iþ1 ; U i Þ ! J Ã iþ1=2 ðU i Þ smoothly as U iþ1 ! U i<label>ð54Þ</label></formula><p>Considering that it is possible to define an approximate Jacobian e J iþ1=2 for the homogeneous part, characterized by a set of approximate eigenvalues k1 ; k2 and eigenvectors ẽ1 ; ẽ2 , two approximate matrices, e P ¼ ð ẽ1 ; ẽ2 Þ and e P À1 are built with the following property:</p><formula xml:id="formula_55">e J iþ1=2 ¼ e P iþ1=2 e K iþ1=2 e P À1 iþ1=2 :<label>ð55Þ</label></formula><p>The difference in vector U across the grid edge is projected onto the matrix eigenvectors basis and the same for the source term:</p><formula xml:id="formula_56">dU iþ1=2 ¼ e P iþ1=2 A iþ1=2 ; S iþ1=2 ¼ e P iþ1=2 B iþ1=2<label>ð56Þ</label></formula><formula xml:id="formula_57">with A iþ1=2 ¼ a 1 a 2 À Á T iþ1=2 and B iþ1=2 ¼ b 1 b 2 À Á T iþ1=2</formula><p>. Expressing all terms more compactly:</p><formula xml:id="formula_58">dF iþ1=2 À S iþ1=2 ¼ X N k m¼1 ð kÃ a ẽÞ m iþ1=2 ;<label>ð57Þ</label></formula><formula xml:id="formula_59">where kÃ;m iþ1=2 ¼ km iþ1=2 h m iþ1=2 ; h m iþ1=2 ¼ 1 À b ka m iþ1=2 ;<label>ð58Þ</label></formula><p>so that the desired matrix in (52) is</p><formula xml:id="formula_60">J Ã iþ1=2 ¼ ð e P e K Ã e P À1 Þ iþ1=2 ;<label>ð59Þ</label></formula><formula xml:id="formula_61">with e K Ã ¼ e KH,</formula><p>where e K iþ1=2 is a diagonal matrix with eigenvalues e k m iþ1=2 in the main diagonal:</p><formula xml:id="formula_62">e K iþ1=2 ¼ e k 1 0 0 e k 2 ! iþ1=2<label>ð60Þ</label></formula><p>and H iþ1=2 is a diagonal matrix with h m iþ1=2 in the main diagonal:</p><formula xml:id="formula_63">H iþ1=2 ¼ h 1 0 0 h 2 ! iþ1=2 :<label>ð61Þ</label></formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.2.">Application to the 1D shallow water equations</head><p>For the 1D shallow water equations the relevant integral formulation in (40) derives from the depth-averaged equations of mass conservation and of momentum, with</p><formula xml:id="formula_64">U ¼ h hu ; F ¼ hu hu 2 þ 1 2 gh 2 ! ; S ¼ 0 p b q w À s b q w ! ;<label>ð62Þ</label></formula><p>where h represents the water depth, u the depth averaged component of the velocity vector and g is the acceleration of the gravity. The source term of the system is split in two kind of terms. The terms p b and s b are the pressure along the bottom and the shear stress in the x direction respectively, with q w the density of water. The above formulation is written in terms of the unit discharge and not valid for arbitrary cross sections. In order to extend the following discussion to general 1D problems <ref type="bibr" target="#b4">[5]</ref> should be followed. The convective part in (40) leads to two real eigenvalues k 1 ; k 2 and eigenvectors e 1 ; e 2 ,</p><formula xml:id="formula_65">k 1 ¼ u À c; k 2 ¼ u þ c; e 1 ¼ 1 u À c ; e 2 ¼ 1 u þ c ;<label>ð63Þ</label></formula><formula xml:id="formula_66">with c ¼ ffiffiffiffiffi ffi gh p .</formula><p>Regarding the source term the following differential equation for the bottom slope can be obtained:</p><formula xml:id="formula_67">p b q w ¼ Àgh @z @x<label>ð64Þ</label></formula><p>The approximate Jacobian e J for the homogeneous part <ref type="bibr" target="#b13">[14]</ref> is</p><formula xml:id="formula_68">e J iþ1=2 ¼ 0 1 c2 À ũ2 2ũ iþ1=2 ; dF iþ1=2 ¼ e J iþ1=2 dU iþ1=2<label>ð65Þ</label></formula><formula xml:id="formula_69">with c ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi ffi g h i þ h iþ1 2 r ; ũ ¼ u iþ1 ffiffiffiffiffiffiffiffi ffi h iþ1 p þ u i ffiffiffiffi h i p ffiffiffiffiffiffiffiffi ffi h iþ1 p þ ffiffiffiffi h i p<label>ð66Þ</label></formula><p>and the resulting set of approximate eigenvalues and eigenvectors are</p><formula xml:id="formula_70">k1 ¼ ũ À c; k2 ¼ ũ þ c; ẽ1 ¼ 1 ũ À c ; ẽ2 ¼ 1 ũ þ c :<label>ð67Þ</label></formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.2.1.">A three wave approximate Riemann solution</head><p>Depending on the flow conditions, three approximate solutions that satisfy (49), are proposed. The solutions for b Uðx; tÞ are governed by the celerities in e K iþ1=2 and each one consists of four regions. The details of the apprimate Riemann solution for each case are provided in Appendix B. Following Godunov's method these RP solutions are then evolved for a time equal to the time step, the resulting solution is cell-averaged obtaining the piecewise solution at the new time level t nþ1 . If both i and i+1 are subcritical, the integral volume in cell ½0; Dx Â ½0; Dt is depicted in Fig. <ref type="figure">8</ref>. Focusing on the updating rule for cell i:</p><formula xml:id="formula_71">U nþ1 i Dx ¼ U ÃÃ i k2 iÀ1=2 Dt þ U n i Dx À k2 iÀ1=2 Dt þ k1 iþ1=2 Dt þ U Ã i À k1 iþ1=2 Dt ;<label>ð68Þ</label></formula><p>that can be rewritten as</p><formula xml:id="formula_72">U nþ1 i Dx ¼ U n i ðDxÞ þ U ÃÃ i À U n i À Á k2 iÀ1=2 Dt þ U n i À U Ã i À Á k1 iþ1=2 Dt<label>ð69Þ</label></formula><p>and considering (183) the updated value U nþ1 i is:</p><formula xml:id="formula_73">U nþ1 i ¼ U n i À ðha ẽk Þ 2 iÀ1=2 Dt Dx À ðha ẽk Þ 1 iþ1=2 Dt Dx :<label>ð70Þ</label></formula><p>Straightforward algebraic manipulation converts (69) to an equivalent numerical flux-based finite volume scheme <ref type="bibr" target="#b7">[8]</ref>,</p><formula xml:id="formula_74">U nþ1 i ¼ U n i À F Ã iþ1=2 À F Ã iÀ1=2 Dt Dx þ S À iþ1=2 þ S þ iÀ1=2 Dt Dx<label>ð71Þ</label></formula><p>in which the numerical flux (denoted by an asterisk) for first-order upwinding is given by</p><formula xml:id="formula_75">F Ã iþ1=2 ¼ 1 2 ðF iþ1 þ F i Þ À 1 2 ðPj e KjP À1 dUÞ iþ1=2 ;<label>ð72Þ</label></formula><p>with a similar expression for F Ã iÀ1=2 and</p><formula xml:id="formula_76">S AE iþ1=2 ¼ ðPI AE P À1 SÞ iþ1=2<label>ð73Þ</label></formula><p>and I AE ¼ K À1 1 2 ðK AE jKjÞ. In Fig. <ref type="figure">8</ref> the time step is small enough so that there is no interaction of waves from neighboring Riemann problems. This would be necessary if we wanted to construct the solution at U nþ1 i in order to explicitly calculate the cell average (68). If positivity of all water depth values in the solutions is guaranteed, h ÃÃ i P 0 and h Ã iþ1 P 0, according to <ref type="bibr" target="#b8">[9]</ref>, in order to use the flux formula (70) it is only necessary that the edge values b Uðx; tÞ remain constant in time over the entire time step, which allows a time step roughly twice as large and the time step is limited by</p><formula xml:id="formula_77">Dt 6 Dt k; Dt k ¼ Dx max m¼1;2 j km j :<label>ð74Þ</label></formula><p>As the cell average is constructed averaging with the terms U ÃÃ i and U Ã iþ1 , the appearance of negative values of h ÃÃ i and h Ã iþ1 must be considered. Fig. <ref type="figure">9</ref> represents a case with a negative value of h ÃÃ iþ1 at a i þ 1=2 edge, where the flow is locally subcritical as in (182). As the approximate solutions used in each RP are independent, it is necessary to define the time step ensuring that the cell average value in the control volume 0; 1  2 Dx</p><formula xml:id="formula_78">Â Ã remains positive h nþ1 iþ1 1 2 Dx ¼ h ÃÃ iþ1 k2 iþ1=2 Dt þ h n iþ1 1 2 Dx À k2 iþ1=2 Dt P 0<label>ð75Þ</label></formula><p>leading to the following limit in the size of the time step </p><formula xml:id="formula_79">Dt 6 Dt ÃÃ ; Dt ÃÃ ¼ 1 2 Dx k2 iþ1=2 h n iþ1 h n iþ1 À h ÃÃ iþ1 ð76Þ or in the case h Ã i &lt; 0 Dt 6 Dt Ã ; Dt Ã ¼ 1 2 Dx k1 iþ1=2 h n i h n i À h Ã i :<label>ð77Þ</label></formula><p>One case of special interest are wet/dry interfaces with discontinuous bed level, as it is possible to generate negative water depths in the initially dry region of widehatUðx; tÞ. According to (76) or (77) the time step becomes nil in that case. To ensure positivity and conservation of the solution for all cases the Godunov's method is formulated as follows:</p><formula xml:id="formula_80">U nþ1 i ¼ U n i À ðdF À SÞ þ iÀ1=2 þ ðdF À SÞ À iþ1=2 Dt Dx ;<label>ð78Þ</label></formula><p>where the fluxes in a general intercell edge i þ 1=2 are computed as follows:</p><formula xml:id="formula_81">If h n iþ1 ¼ 0 and h ÃÃ iþ1 &lt; 0 set: ðdF À SÞ À iþ1=2 ¼ ðdF À SÞ iþ1=2 ; ðdF À SÞ þ iþ1=2 ¼ 0:<label>ð79Þ</label></formula><formula xml:id="formula_82">If h n i ¼ 0 and h Ã i &lt; 0 set: ðdF À SÞ þ iþ1=2 ¼ ðdF À SÞ iþ1=2 ; ðdF À SÞ À iþ1=2 ¼ 0:<label>ð80Þ</label></formula><p>Otherwise set:</p><formula xml:id="formula_83">ðdF À SÞ AE iþ1=2 ¼ X N k m¼1 ð kAE ha ẽÞ m iþ1=2 ;<label>ð81Þ</label></formula><formula xml:id="formula_84">with kAE;m iþ1=2 ¼ 1 2 ð k AE j kjÞ:<label>ð82Þ</label></formula><p>The two main ways of formulating the Godunov type numerical solution for a system are then presented as it was done before for the scalar case. Note that because the numerical source integral cannot, in general, be written as a difference, it is not possible to include it in the numerical flux difference formulation (71). This means that the balance sought between flux derivatives and sources in the numerical flux based scheme can only be achieved locally by balancing non-zero fluxes through the edges of the control volume instead of setting every component to zero as in (78).</p><p>When in supercritical conditions values of h Ã i &lt; 0 or h ÃÃ iþ1 &lt; 0 appear, the cell averaging in the Godunov method avoids negative values of h, as the source term does not participate in the updating of the water depth. In consequence, the stability region becomes:</p><formula xml:id="formula_85">Dt 6 minðDt ÃÃ ; Dt Ã ; Dt kÞ if ð k1k2 Þ iþ1=2 &lt; 0; Dt k otherwise; (<label>ð83Þ</label></formula><p>where Dt ÃÃ is defined as in (76) if h ÃÃ iþ1 &lt; 0 and h n iþ1 -0 and Dt Ã is defined as in (77) if h Ã i &lt; 0 and h n i -0. One result of Roe's linearization is that the resulting approximate Riemann solution consists of only discontinuities and b Uðx; tÞ is constructed as a sum of jumps or shocks. To avoid unphysical results the version of the Harten-Hyman entropy fix <ref type="bibr" target="#b17">[18]</ref> is used. In the case of left transonic rarefaction </p><formula xml:id="formula_86">k 1 i &lt; 0 &lt; k 1 iþ1 , with k i ¼ kðU i Þ and k iþ1 ¼ kðU iþ1 Þ, the jump associated to k1 iþ1=2 is decomposed into two new jumps, k 1 ¼ k 1 i k 1 iþ1 À k1 k 1 iþ1 À k 1 i À Á; k1 ¼ k 1 iþ1 e k 1 À k 1 i k 1 iþ1 À k 1 i À Á;<label>ð84Þ</label></formula><formula xml:id="formula_87">with k 1 þ b k 1 ¼ e k 1 ,</formula><formula xml:id="formula_88">1 þ b b 1 ¼ b 1 .</formula><p>Numerically it is possible to force a splitting proportional to the one performed on the k1 iþ1=2 wave, that is b</p><formula xml:id="formula_89">1 ¼ b 1 k 1 k1 ; b1 ¼ b 1 k1 k1<label>ð85Þ</label></formula><p>but this option results in erroneous results and in a reduction of the time step size, as the values of b 1 and b1 as defined in (85) are much greater than the original one, b 1 , as under these conditions k1 is a travelling wave with almost nil velocity. The option used in this work is b</p><formula xml:id="formula_90">1 ¼ b 1 ; b1 ¼ 0;<label>ð86Þ</label></formula><p>that preserves the stability region in (83), simply replacing k1 iþ1=2 by k 1 iþ1=2 . For a right transonic rarefaction k 2 i &lt; 0 &lt; k 2 iþ1 , the entropy fix procedure is entirely analogous to the left rarefaction case. The single jump in k2 is split into two smaller jumps k 2 and k2</p><formula xml:id="formula_91">k 2 ¼ k 2 iþ1 ð k2 À k 2 i Þ k 2 iþ1 À k 2 i À Á; k2 ¼ k 2 i k 2 iþ1 À k2 k 2 iþ1 À k 2 i À Á;<label>ð87Þ</label></formula><p>with k 2 &gt; 0 and k2 &lt; 0 by definition. The source term is split enforcing</p><formula xml:id="formula_92">b 2 ¼ b 2 ; b 2 ¼ 0;<label>ð88Þ</label></formula><p>so the stability region in (83) is preserved, simply replacing k2 iþ1=2 by k 2 iþ1=2 .</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.3.">Integration of the source term</head><p>The source term in (50) is expressed as</p><formula xml:id="formula_93">S iþ1=2 ¼ 0 p b q w À s b q w ! iþ1=2 ;<label>ð89Þ</label></formula><p>where p b q w and s b q w attend to the pressure and friction exerted on the bed respectively. There is not a unique way to perform the numerical integral of the source term in (50). Under the hypothesis of smooth variation of the variables and an infinitesimal width of the control volume, it is possible to define the integral in (50) eval-</p><formula xml:id="formula_94">uating p b q w as p b q w a iþ1=2 ¼ Àgð hdzÞ iþ1=2 ;<label>ð90Þ</label></formula><formula xml:id="formula_95">with h ¼ 1=2ðh i þ h iþ1 Þ.</formula><p>Assuming a piecewise representation of the bed level, another possibility is to use the physical definition of the hydrostatic force exerted over the bed discontinuity so the pressure head depends only on the free-surface level. Attending to this definition, (50) is defined using the following approach for p b q w :</p><formula xml:id="formula_96">p b q w b iþ1=2 ¼ Àg h j À jdz 0 j 2 dz 0 ;<label>ð91Þ</label></formula><formula xml:id="formula_97">with j ¼ i if dz P 0; i þ 1 if dz &lt; 0; &amp; dz 0 ¼ h i if dz P 0 and d i &lt; z iþ1 ; h iþ1 if dz &lt; 0 and d iþ1 &lt; z i ; dz otherwise; 8 &gt; &lt; &gt; :<label>ð92Þ</label></formula><p>where d ¼ ðh þ zÞ. Both approaches can be blended to provide another expression for the thrust term, that we will refer to as</p><formula xml:id="formula_98">p b q w c : p b q w c iþ1=2 ¼ max p b q w a ; p b q w b iþ1=2</formula><p>if dd dz P 0 and ũdz &gt; 0;</p><formula xml:id="formula_99">p b q w b iþ1=2 otherwise; 8 &gt; &gt; &gt; &lt; &gt; &gt; &gt; :<label>ð93Þ</label></formula><p>that considers the problems associated to flow across an upward step in overtopping waves.</p><p>In cases of still water with a continuous water level surface all three approximations of the trust term, a, b and c, provide correct solutions for all values when constructing the approximate solution b</p><p>Uðx; tÞ, as in this particular case, Fig. <ref type="figure" target="#fig_29">10</ref>:</p><formula xml:id="formula_100">h n i þ z i ¼ h Ã i þ z i ¼ h ÃÃ iþ1 þ z iþ1 ¼ h n iþ1 þ z iþ1 ; ðhuÞ n i ¼ ðhuÞ Ã i ¼ ðhuÞ ÃÃ iþ1 ¼ ðhuÞ n iþ1 ¼ 0:<label>ð94Þ</label></formula><p>This is a particular case, and in cases of nonzero velocity, differences among the solutions provided by the source term integral in ðp b =q w Þ a ; ðp b =q w Þ b and ðp b =q w Þ c arise. One consequence of utmost importance is that they can generate negative values of water depth in the inner regions of the weak solution. In wetting/drying fronts negative values can be avoided if in each i þ 1=2 edge with discontinuous water level surface, characterized by</p><formula xml:id="formula_101">h n i þ z i &lt; z iþ1 ; h n iþ1 ¼ 0<label>ð95Þ</label></formula><formula xml:id="formula_102">or h n iþ1 þ z iþ1 &lt; z i ; h n i ¼ 0;<label>ð96Þ</label></formula><p>a zero velocity in the involved cells is enforced, u n iþ1 ¼ u n i ¼ 0, in combination with approach ðp b =q w Þ c . This procedure, that considers the cell edges characterized by ( <ref type="formula" target="#formula_101">95</ref>) or (96) as solid walls, will be referred to as approach ðp b =q w Þ c;w .</p><p>Regarding the friction term, the discretization based on <ref type="bibr" target="#b11">[12]</ref> is applied</p><formula xml:id="formula_103">s b q wf ;iþ1=2 ¼ gð hS f Þ iþ1=2 Dx; S f ;iþ1=2 ¼ n 2 ũjũj maxðh i ; h iþ1 Þ 4=3 ! iþ1=2 :<label>ð97Þ</label></formula><p>The importance of the discrete equilibrium in cases of still water to provide well-balanced schemes has been widely reported, but it is important to stress that with the unified formulation of the source terms, the scheme becomes well balanced in steady cases with no null velocity. According to numerical scheme (78), the stationary solution is reached when all updating components of the linearized solution become nil, that is ðhaÞ m iþ1=2 ¼ 0 for m = 1, 2, leading to a constant discharge in all zones of the weak solution. In the subcritical case:</p><formula xml:id="formula_104">ðhuÞ n i ¼ ðhuÞ Ã i ¼ ðhuÞ ÃÃ iþ1 ¼ ðhuÞ n iþ1 -0;<label>ð98Þ</label></formula><p>or in the supercritical case, with u &gt; 0:</p><formula xml:id="formula_105">ðhuÞ n i ¼ ðhuÞ Ã iþ1 ¼ ðhuÞ ÃÃ iþ1 ¼ ðhuÞ n iþ1 -0:<label>ð99Þ</label></formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.4.">Reconstruction of the approximate solution b</head><p>Uðx; tÞ</p><p>The linearization of the source terms leads to extremely small values of the allowable time step, as Dt ÃÃ or Dt Ã can be various order of magnitude smaller than Dt k. This can be avoided by means of a reconstruction of the approximate solution b Uðx; tÞ. The strategy proposed here is based on enforcing positive values of h Ã i and h ÃÃ iþ1 when they become negative. Considering that ẽ1</p><formula xml:id="formula_106">1 ¼ 1, positive values of h Ã i require that h Ã i ¼ h n i þ a 1 iþ1=2 À b k 1 iþ1=2 P 0<label>ð100Þ</label></formula><formula xml:id="formula_107">leading to the following limit over b 1 b 1 iþ1=2 P b 1 min ; b 1 min ¼ À h n i þ a 1 iþ1=2 j k1 iþ1=2 j:<label>ð101Þ</label></formula><formula xml:id="formula_108">Considering that ẽ2 1 ¼ 1, positive values of h ÃÃ iþ1 require that h ÃÃ iþ1 ¼ h n iþ1 À a 2 iþ1=2 þ b k 2 iþ1=2 P 0<label>ð102Þ</label></formula><p>and a limit over b 2 appears</p><formula xml:id="formula_109">b 2 iþ1=2 P b 2 min ; b 2 min ¼ À h n iþ1 À ðaÞ 2 iþ1=2 k2 iþ1=2 :<label>ð103Þ</label></formula><p>The reconstruction proposed in this work will be applied only to subcritical wet/wet RP, as in dry/wet RP the appearance of negative values of h  (</p><formula xml:id="formula_110">b 1 ¼ Àb 2 :<label>ð105Þ</label></formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.5.">Dam break test cases</head><p>In this section we present comparisons among exact solutions of the Riemann problem for system (40), neglecting friction, and numerical solutions. The exact solution corresponding to a frictionless dambreak flow over a discontinuous bed is detailed in Appendix C. The results are presented in the form of plots of the total depth, mean discharge, Froude number and energy per unit weight or head. The examples are chosen to represent different combinations of wave patterns. The acceleration due to gravity is set equal to g = 9.8 m 2 /s. In all cases the bottom step is positioned at x = 0 and has a variable height. In all cases Dx ¼ 1 and CFL = 1. When applying the reconstruction technique of the weak solution proposed in (104) and (105) no difference in the solution has been observed when comparing with the original solution.</p><p>Test case 1 is a dam-break type problem, with a combination of rarefaction and shock waves. The initial condition consists of two columns of water of different height and zero velocity. The solution, presented in Fig. <ref type="figure" target="#fig_11">11</ref> , contains a left moving rarefaction wave, a stationary shock at the step and a right-moving shock wave. The presence of the step leads to a reduction of the total water height running to the right as compared to the flat bottom case. This reduction is due to the stationary shock, which dissipates part of the energy of the shock wave. All three approximations of the pressure term, ðp b =q w Þ a ; ðp b =q w Þ b and ðp b =q w Þ c , provide results of similar accuracy, for the total depth, mean velocity, Froude number and energy. The options ðp b =q w Þ b and ðp b =q w Þ c in particular overlap completely so that they cannot be distinguished in the plot. The position of the fan expansion and the shock are correct and the discharge does not present oscillations in the origin. The correct behavior of the numerical scheme is explained attending to the characteristics of the weak solution, that in a subcritical case, provides a constant value of discharge for the two inner regions U Ã i and U ÃÃ iþ1 , according to the exact solution (see Table <ref type="table" target="#tab_1">2</ref>). Test case 2 is also a dam-break type problem, with a combination of rarefaction and shock waves. The initial condition consists of two columns of water of different heights and velocity on the left side. The solution, presented in Fig. <ref type="figure" target="#fig_0">12</ref>, contains a left moving rarefaction wave, a stationary shock at the step and a right-moving shock wave. The numerical solution for approximation ðp b =q w Þ a differs strongly from the analytical solution for all the plotted variables, and also provides an increment of the total water height. Approximations of the pressure term, ðp b =q w Þ b and ðp b =q w Þ c , provide the same results, leading to a correct description of the total depth, the mean discharge, Froude number and compute the energy dissipation correctly.</p><p>Test case 3 is a two shock case with a convergent flow. The solution is presented in Fig. <ref type="figure" target="#fig_13">13</ref>, and contains a left-moving shock, a stationary shock at the step and a right-moving shock wave. As in the previous example, the step acts as an energy dissipation mechanism. All three approximations of the pressure term, ðp b =q w Þ a ; ðp b =q w Þ b and ðp b =q w Þ c , provide results of similar accuracy, for the total depth, mean discharge and Froude number, as this case corresponds to a relatively mild slope.  The strongest differences appear in the total water height, with ðp b =q w Þ b and ðp b =q w Þ c providing the most energy dissipative solutions.</p><p>Test case 4 is also a two shock case with a convergent flow, with an initial discontinuity in the water depth. The performance of the numerical scheme in cases with this type of discontinuity is of major importance in practice. As in test case 3, the solution, depicted in Fig. <ref type="figure" target="#fig_14">14</ref>, contains a left-moving shock, a stationary shock at the step and a right-moving shock wave. All solutions provide an adequate description of the water discharge at the dam break position, x = 0 m, but the differences among the results for the rest of variables are noticeable. Approach ðp b =q w Þ a lead to unphysical result for the total water height, while approach ðp b =q w Þ b , strongly overestimates the velocity of the right moving shock and underestimates the velocity of the left moving shock. The hybrid option ðp b =q w Þ c combines the best properties of both approaches leading to superior results, not only providing an energy dissipating solution but also reaching better results for the rest of variables. The differences with the exact solution are attributable to the linearization of the source term when constructing the weak solution.</p><p>Test case 5 is a dam-break type problem, with a combination of rarefaction and shock waves, but in contrast with test cases 1 and 2, the initial condition consists of two columns of water of different heights, velocity in the left side and a backward step of height similar to the right column of water. The solution, presented in Fig. <ref type="figure" target="#fig_15">15</ref>, contains a left moving rarefaction wave, a stationary shock at the step and a right-moving shock wave. The presence of the step dissipates part of the energy. Approximations of the pressure term ðp b =q w Þ b and ðp b =q w Þ c , that provide identical results, lead to a description of the total depth, the mean discharge, Froude number and compute the energy dissipation closer to the exact solution. Again, the differences still shown by approaches ðp b =q w Þ b and ðp b =q w Þ c with respect to the exact solution are attributable to the linearization of the source term when constructing the weak solution. Test case 6 is similar to test case 5, but with a stronger discontinuity in the water elevation, and a very thin layer of water 0n the right side. The solution is presented in Fig. <ref type="figure" target="#fig_16">16</ref>. Only approximations of the pressure term ðp b =q w Þ b and ðp b =q w Þ c , that provide identical results, lead to a correct description of the total depth, the mean discharge, Froude number and compute the energy dissipation. Approach ðp b =q w Þ a , provides a solution totally inadequate and distorted if compared with the analytical case.</p><p>In test case 7 a supercritical motion from left to right is considered. The presence of the step introduces no limitation in the signal propagation upstream, and its effect is in dissipating energy by the stationary shock at the step. The solution, presented in Fig. <ref type="figure" target="#fig_17">17</ref>, contains a stationary shock at the step, a right moving rarefaction wave, and a right-moving shock wave. Only approximations of the pressure term ðp b =q w Þ b and ðp b =q w Þ c , that provide identical results, lead to a correct description of the total depth, the mean discharge, Froude number and compute the energy dissipation correctly. Approach ðp b =q w Þ a , provides an unphysical solution for the total water height. For all approaches the computed discharge is kept constant and equal to the left value, ðhuÞ L , until the solution reaches the rarefaction wave. This is explained attending to the definition of the weak solution for supercritical cases in (185), that provides an adequate value for the inner region, resulting in ðhuÞ n i ¼ ðhuÞ Ã iþ1 according to the exact solution. In test cases 8-11 the performance of the numerical scheme in RPs characterized by a fixed in time wet/dry position are analysed. Depending on the approach of the source term the flow develops in both regions of the plain. This is avoided if the weak solution provides null or negative values of water depth in the initially dry side of the RP. In this context, the performance of the energy dissipative approach ðp b =q w Þ c;w is of interest.</p><p>In test case 8 a subcritical flow encounters a wall and is reflected. The solution, presented in Fig. <ref type="figure" target="#fig_18">18</ref>, contains a left-moving shock that links the right moving water with a region of still water ending at the stationary shock at x = 0. The bed elevation on the right side is greater than the maximum allowable water depth in the wet region at rest. Only approximations of the pressure term ðp b =q w Þ a ; ðp b =q w Þ c and ðp b =q w Þ c;w provide a correct solution in the left side, while ðp b =q w Þ b , develops in both sides leading to incorrect solutions. Option ðp b =q w Þ c;w provides more accurate results for both water depth and flow discharge. The same results are observed for test case 9, Fig. <ref type="figure" target="#fig_19">19</ref>, where a supercritical flow encounters a wall and is reflected.</p><p>In test case 10 a subcritical flow moving to the left generates a left moving rarefaction connecting the left state with a state of water at rest, with a water depth smaller than the depth of the wall defined in the other side. The solution is presented in Figs. <ref type="figure" target="#fig_35">20</ref> and<ref type="figure" target="#fig_21">21</ref>. Approximations of the pressure term ðp b =q w Þ a and ðp b =q w Þ c develop correctly in the left side of the (x,t) plane, although present an oscillatory behavior in the zero velocity region. The results for approach ðp b =q w Þ c;w do not present any oscillation in the region of zero velocity but estimate less accurately the velocities at the tail and the head of the rarefaction. Again ðp b =q w Þ b provides an incorrect solution.</p><p>The situation is much more interesting in test case 11, where supercritical flow conditions are enforced in the left side. Again ðp b =q w Þ b provides an incorrect solution and ðp b =q w Þ a ; ðp b =q w Þ c lead to similar results. Results given by approach ðp b =q w Þ c;w follow the same tendency as in test case 10.</p><p>According to the hypothesis assumed to derive the exact solution, the solutions in test cases 8-11 should be independent of the actual height of the dry step z R . That is, if the value of the dry bed level z R decreases until a value equal to the water depth in the region of zero velocity, that will be referred to as h L;0 , the solution remains equal. However, due to the approximation used to define the bed discontinuity, this has an influence, and before z R reaches the limit h L;0 , numerical solutions evolve in both regions. Table <ref type="table" target="#tab_4">3</ref> shows the numerical limits that can be reached by the value of z R before the solution is altered. For test cases 8 and 9, among the approaches described, ðp b =q w Þ c;w provides the most accurate limiting value, denoted z c;w R , while approaches ðp b =q w Þ a and ðp b =q w Þ c require larger values to ensure a correct solution. If ðp b =q w Þ b is used, the solution fails for all values of z b R . For test case 10 in Table <ref type="table" target="#tab_4">3</ref> shows that ðp b =q w Þ c;w leads to the best results when decreasing the value for z R and that ðp b =q w Þ b fails in all cases. It is noticeable that, in case 11, approaches ðp b =q w Þ a ; ðp b =q w Þ c and ðp b =q w Þ c;w lead to similar limits for z R .</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="3.6.">Dam break over an adverse slope</head><p>In the following test case the numerical solution of a dam break case, over an adverse dry bed is analyzed. A frictionless, confined domain 250 m long, presents the following initial conditions and bathymetry:</p><formula xml:id="formula_111">hðx; 0Þ ¼ 0:8 if x &lt; 50; 0 if x &gt; 50; &amp; uðx; 0Þ ¼ u o ðxÞ ¼ 0; zðxÞ ¼ 1:2 i fx &lt; 50; 0:01ðx À 50Þ if x &gt; 50: &amp;<label>ð106Þ</label></formula><p>Although no exact solution is presented for this test case it is useful to note the effect of the reconstruction techniques in (104) and (105). In this test case the left column of water must fall, leading to a left rarefaction in the flat bed region and to a flooding wave over an adverse initially dry slope. In all cases Dx ¼ 1 m, CFL = 1 approach ðp b =q w Þ c is used. Fig. <ref type="figure" target="#fig_22">22</ref>(a) and (b) show the bed level surface and water discharge at time t = 45 s given the numerical scheme (78), when computed using the original weak solutions (182)-( <ref type="formula" target="#formula_190">188</ref>) ðÀ ÀÞ and computed using modified weak solutions ðÀMÀÞ generated through the reconstruction techniques in (104) and (105). The results for both weak solutions present no differences for the rarefaction wave and the advancing front. Fig. <ref type="figure" target="#fig_35">24</ref> displays time step evolution in time with the original weak solution ðÀ ÀÞ and with the reconstructed weak solution ðÀMÀÞ. It can be seen that the time step for both solutions is equal during approximately the first 45 seconds, as the source terms do not play a major role in the stability region, governed by Dt k.</p><p>As time evolves the water level in the flat left region decreases. Fig. <ref type="figure" target="#fig_35">23(c</ref>) shows that at time t = 50 s the original weak solution provides smaller values of water depth than the reconstructed weak solution in the nodes located after and before the ending of the flat bed, how this difference is more noticeable at time t ¼ 55 s, as depicted in Fig. <ref type="figure" target="#fig_35">23(e)</ref>. Also, less oscillatory results for the water discharge are computed in the same location, as seen in Fig. <ref type="figure" target="#fig_35">23(d</ref>) for t = 50 s and (f) t = 55 s. Almost unnoticeable differences appear in the advancing front.</p><p>Fig. <ref type="figure" target="#fig_35">24</ref> shows that, when both approximate solutions begin to diverge, the time step size also does so. For times approximately between t = 45 and t = 50 s, smaller values of time step are required for the original weak solution if compared with the ones required by the modified solution. For longer times, the time step for the original weak solution becomes several orders of magnitude smaller than the time step for the reconstructed solution, as the source terms influence the stability region, rendering the simulation of longer times than t = 55 impossible. On the other hand, the reconstructed solution allows a time step size of constant order of magnitude.</p><p>In the previous section approach ðp b =q w Þ c;w lead to accurate results for reflection waves and rarefactions in stationary wet/dry problems. Fig. <ref type="figure" target="#fig_35">23</ref> shows the results given by the energy dissipative approach ðp b =q w Þ c;w compared with those given by approach ðp b =q w Þ c . As expected, the main difference appears in the velocity of the advancing front.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.">2D systems of equations with source terms</head><p>The previous ideas are next extended to 2D hyperbolic nonlinear systems of equations with source terms of the form @U @t þ @FðUÞ @x þ @GðUÞ @y ¼ SðU; x; yÞ:</p><p>System (107) is time dependent, nonlinear, and contains source terms. Under the hypothesis of dominant advection it can be classified and numerically dealt with as belonging to the family of hyperbolic systems. The mathematical properties of (107) include the existence of a Jacobian matrix, J n , of the flux normal to a direction given by the unit vector n, En, with E ¼ Fn x þ Gn y , defined as</p><formula xml:id="formula_113">J n ¼ @En @U ¼ @F @U n x þ @G @U n y :<label>ð108Þ</label></formula><p>This Jacobian can be used to form the basis of the upwind numerical discretization that will be outlined in next section. </p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.1.">Approximate Riemann solution</head><p>To introduce the finite volume scheme, (107) is integrated in a volume or grid cell X:</p><formula xml:id="formula_114">@ @t Z X UdX þ Z X ð rEÞdX ¼ Z X SdX<label>ð109Þ</label></formula><p>and applying the Gauss theorem becomes</p><formula xml:id="formula_115">@ @t Z X UdX þ I @X Endl ¼ Z X SdX;<label>ð110Þ</label></formula><p>where n ¼ ðn x ; n y Þ is the outward unit normal vector to the volume X.</p><p>In order to obtain a numerical solution of system (107) we divide the domain in computational cells, X i , using a mesh fixed in time. Let Dt be the time step and t n ¼ nDt a generic time. Assuming the usual notation we indicate with U n i the cell-average value of the solution Uðx; y; tÞ for the ith cell at time t n :</p><formula xml:id="formula_116">U n i ¼ 1 A i Z X i Uðx; y; t n Þdx;<label>ð111Þ</label></formula><p>where A i is the cell area. Assuming a piecewise representation of the conserved variables (110) is written as</p><formula xml:id="formula_117">@ @t Z X i UdX þ X NE k¼1 E j n k l k ¼ Z X i SdX;<label>ð112Þ</label></formula><p>with E j the value of the function E at the neighbouring cell j connected through the edge k; n k ¼ ðn x ; n y Þ, is the outward unit normal vector to the cell edge k; l k is the corresponding edge length and NE is the number of edges in cell i. Considering that the quantity E i is uniform per cell i and that Eq. ( <ref type="formula" target="#formula_117">112</ref>) is written as</p><formula xml:id="formula_118">X NE k¼1 n k l k ¼ 0:<label>ð113Þ</label></formula><formula xml:id="formula_119">@ @t Z X i UdX þ X NE k¼1 ðdEÞ k n k l k ¼ Z X i SdX;<label>ð114Þ</label></formula><formula xml:id="formula_120">with dE ¼ E j À E i .</formula><p>In the Roe approach, the solution of each RP is obtained from the exact solution of a locally linearized problem. In the 2D framework the solution is obtained reducing each RP at each k edge to a 1D Riemann problem projected onto the direction n. The linearized solution must fulfill the Consistency Condition. In the 2D case the integral of the approximate solution b</p><p>Uðx 0 ; tÞ of the k linearized RP over a suitable control volume must be equal to the integral of the exact solution Uðx 0 ; tÞ over the same control volume, with x 0 the coordinate normal to the cell edge k, Fig. <ref type="figure" target="#fig_35">25</ref>. Then in each k Riemann problem with initial values U i ; U j , in a time interval [0,1] and a space interval ½ÀX 0 ; X 0 , where</p><formula xml:id="formula_121">ÀX 0 6 k min ; X 0 P k max<label>ð115Þ</label></formula><p>and k min ; k max the positions of the slowest and the fastest wave at t = 1, in a k egde, the solution b Uðx 0 ; 1Þ at time t = 1 must satisfy the following property:</p><formula xml:id="formula_122">Z þX 0 ÀX 0 b Uðx 0 ; 1Þ dx 0 ¼ Z þX 0 ÀX 0</formula><p>Uðx 0 ; 1Þ dx 0 ; ð116Þ so using (114) the Consistency Condition becomes:</p><formula xml:id="formula_123">Z þX 0 ÀX 0 b Uðx 0 ; 1Þ dx 0 ¼ X 0 ðU R þ U L Þ À dEn þ Z 1 0 Z þX 0 ÀX 0 S dx 0 dt:<label>ð117Þ</label></formula><p>Since the source terms are not necessarily constant in time, we assume the following time linearization of the Consistency Condition:  where following previous work, <ref type="bibr" target="#b19">[20]</ref> Z þX 0 ÀX 0</p><formula xml:id="formula_124">Z þX 0 ÀX 0 b Uðx 0 ; 1Þ dx 0 ¼ XðU R þ U L Þ À ðdE À TÞ k n k ;<label>ð118Þ</label></formula><formula xml:id="formula_125">0 0.5<label>1 1.5 2 2.5 3 3.5 4 4.5 -25 -20 -15 -10 -5 0 5 h+z (m) x (m) 0 0.5 1 1.5 2 2.5 3 3.5</label></formula><formula xml:id="formula_127">Sðx 0 ; 0Þ dx 0 ¼ ðTnÞ n k ;<label>ð119Þ</label></formula><p>where T is a suitable numerical source matrix. This enables the following formulation of (114)</p><formula xml:id="formula_128">@ @t Z X UdX i þ X NE k¼1 ðdE À TÞ k n k l k ¼ 0;<label>ð120Þ</label></formula><p>that is approximated by using the following linear problem</p><formula xml:id="formula_129">@ @t R X b UdX i þ P NE k¼1 J Ã n;k d b U k l k ¼ 0; b Uðx 0 ; 0Þ k ¼ U i if x 0 &lt; 0; U j if x 0 &gt; 0: &amp;<label>ð121Þ</label></formula><p>Integrating the previous PDE system over the same control volume the following expression is obtained in each k edge</p><formula xml:id="formula_130">Z þX 0 ÀX 0 b Uðx 0 ; 1Þ dx 0 ¼ XðU i þ U j Þ À J Ã ðU j À U i Þ ð<label>122Þ</label></formula><p>and since we want to satisfy (118), the constraint that follows is:</p><formula xml:id="formula_131">ðdE À TÞ k n k ¼ e J Ã ðU iþ1 À U i Þ:<label>ð123Þ</label></formula><p>Due to the non-linear character of the flux E, the definition of an approximated Jacobian matrix, e J n;k , allows for a local linearization and is exploited here <ref type="bibr" target="#b13">[14]</ref>. This approach provides a set of three real eigenvalues km k and eigenvectors ẽm k . Then, it is possible to define two approximate matrices e P ¼ ð ẽ1 ; ẽ2 ; ẽ3 Þ and e P À1 with the following properties e J n;k ¼ e</p><formula xml:id="formula_132">dðEnÞ k ¼ e J n;k dU k<label>ð124Þ</label></formula><formula xml:id="formula_133">P k e K k e P À1 k :<label>ð125Þ</label></formula><p>The difference in vector U across the grid edge is projected onto the matrix eigenvectors basis and the same for the source term:</p><formula xml:id="formula_134">dU k ¼ e P k A k ; ðTnÞ k ¼ e P k B k ;<label>ð126Þ</label></formula><formula xml:id="formula_135">with A k ¼ a 1 a 2 a 3 À Á T k and B k ¼ b 1 b 2 b 3 À Á T k .</formula><p>Expressing all terms more compactly:</p><formula xml:id="formula_136">dðEnÞ k À ðTnÞ k ¼ X N k m¼1 ð k ha ẽÞ m k ;<label>ð127Þ</label></formula><formula xml:id="formula_137">with h m k ¼ 1 À b ka m k<label>ð128Þ</label></formula><p>it is possible to define the desired matrix in (123)  </p><formula xml:id="formula_138">e J Ã k ¼ ð e P e K Ã e P À1 Þ k ;<label>ð129Þ</label></formula><formula xml:id="formula_139">with e K Ã ¼ e KH,</formula><formula xml:id="formula_140">e K k ¼ k1 0 0 0 k2 0 0 0 k3 0 B @ 1 C A k ; H k ¼ h 1 0 0 0 h 2 0 0 0 h 3 0 B @ 1 C A k :<label>ð130Þ</label></formula></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.2.">Application to the 2D shallow water equations</head><p>The two-dimensional shallow water equations, which represent mass and momentum conservation in a plane, can be obtained by depth-averaging the Navier-Stokes equations. Neglecting diffusion of momentum due to viscosity and turbulence, wind effects and the Coriolis term, they form a system of equations <ref type="bibr" target="#b0">[1]</ref> as in (107), where</p><formula xml:id="formula_141">U ¼ ðh; q x ; q y Þ T<label>ð131Þ</label></formula><p>are the conserved variables with h representing the water depth, q x ¼ hu and q y ¼ hv, with (u, v) the depth averaged components of the velocity vector u along the (x, y) coordinates respectively. The fluxes of these variables are given by:</p><formula xml:id="formula_142">F ¼ q x ; q 2 y h þ 1 2 gh 2 ; q x q y h ! T ; G ¼ q y ; q x q y =h; q 2 y h þ 1 2 gh 2 ! T ;<label>ð132Þ</label></formula><p>where g is the acceleration of the gravity. The source terms of the system are the bed slope and the friction terms:</p><formula xml:id="formula_143">S ¼ 0; p b;x q w À s b;x q w ; p b;y q w À s b;y q w T ;<label>ð133Þ</label></formula><p>where the bed slopes of the bottom level z in its differential form are  </p><formula xml:id="formula_144">p b;x q w ¼ Àgh @z @x ; p b;y q w ¼ Àgh @z @y<label>ð134Þ</label></formula><p>and the friction losses are written in terms of the Manning's roughness coefficient n:</p><formula xml:id="formula_145">s b;x q w ¼ ghS fx ; S fx ¼ n 2 u ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi u 2 þ v 2 p h 4=3 ; s b;y q w ¼ ghS fy ; S fy ¼ n 2 v ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi u 2 þ v 2 p h 4=3 :<label>ð135Þ</label></formula><p>The approximate Jacobian e J n;k for the homogeneous part is constructed with the following averaged variables <ref type="bibr" target="#b13">[14]</ref> ũk</p><formula xml:id="formula_146">¼ u i ffiffiffiffi h i p þ u j ffiffiffiffi h j p ffiffiffiffi h i p þ ffiffiffiffi h j p ; ṽk ¼ v i ffiffiffiffi h i p þ v j ffiffiffiffi h j p ffiffiffiffi h i p þ ffiffiffiffi h j p ; ck ¼ ffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffiffi ffi g h i þ h j 2 r<label>ð136Þ</label></formula><p>leading to   Following Godunov's method, the solutions of these RP's are evolved for a time equal to the time step and the resulting solution is cell-averaged. The volume integral in the cell at time t nþ1 is:</p><formula xml:id="formula_147">k1 k ¼ ð ũn À cÞ k ; k2 k ¼ ð ũnÞ k ; k3 k ¼ ð ũn þ cÞ k<label>ð137Þ</label></formula><formula xml:id="formula_148">and ẽ1 k ¼ 1 ũ À cn x ṽ À cn y 0 B @ 1 C A k ; ẽ2 k ¼ 0 Àcn y cn x 0 B @ 1 C A k ; ẽ3 k ¼ 1 ũ þ cn x ṽ þ cn y 0 B @ 1 C A k :<label>ð138Þ</label></formula><formula xml:id="formula_149">U nþ1 i A i ¼ U n i A i À X NE k¼1 X 3 m¼1 ð kÀ ha ẽÞ m k l k Dt;<label>ð139Þ</label></formula><formula xml:id="formula_150">with kAE;m k ¼ 1 2 ð k AE j kjÞ m k .</formula><p>Again, algebraic manipulation converts (139) to an equivalent numerical flux-based finite volume scheme <ref type="bibr" target="#b7">[8]</ref>,</p><formula xml:id="formula_151">U nþ1 i ¼ U n i À X k E Ã k n k l k Dt A i þ X k ðTnÞ À k l k Dt A i<label>ð140Þ</label></formula><p>in which the numerical flux (denoted by an asterisk) for first-order upwinding is given by  </p><formula xml:id="formula_152">E Ã k n k ¼ 1 2 ððE i þ E j Þn À</formula><p>with I AE ¼ K À1 1 2 ðK AE jKjÞ. When cell averaging the solution in the 1D dimensional case the time step Dt is taken small enough so that there is no interaction of waves from neighboring Riemann problems, attending to a distance Dx=2. In the 2D framework, considering unstructured meshes, the equivalent distance to Dx, that will be referred to as v i in each cell i must consider the volume of the cell and the length of the shared k edges</p><formula xml:id="formula_154">v i ¼ A i max k¼1;NE l k :<label>ð143Þ</label></formula><p>Considering that each k RP is used to deliver information between each pair of neighboring cells of different size, the associated distance minðA i ; A j Þ=l k is relevant, so in case that ĥðx 0 ; tÞ P 0 in all k RP's the time step is limited by</p><formula xml:id="formula_155">Dt 6 CFLDt k; Dt k ¼ minðv i ; v j Þ max m¼1;2;3 j km j ;<label>ð144Þ</label></formula><p>with CFL = 1/2 in the case of rectangular or structured triangular cells and, according to computational experience, CFL close to 1 for triangular unstructured grids as the construction of finite volume schemes from direct application of one-dimesional fluxes leads to reduced stability ranges <ref type="bibr" target="#b17">[18]</ref>. It is possible to find values of h &lt; 0 for some region of the approximate solution b Uðx 0 ; tÞ. In case of generating a negative value of h ÃÃÃ j in a subcritical problem, as each RP is independent, to force stability, a limiting distance 1 2 v j is defined and the cell averaged scheme becomes:</p><formula xml:id="formula_156">h nþ1 j 1 2 v j ¼ h ÃÃ j k2 k Dt þ h ÃÃÃ j k3 k À k2 k Dt þ h n j 1 2 v j À k3 iþ1=2 Dt P 0:<label>ð145Þ</label></formula><p>Attending to the definition of ẽ2 it is clear that h</p><formula xml:id="formula_157">ÃÃ j ¼ h ÃÃÃ j</formula><p>and ( <ref type="formula" target="#formula_156">145</ref>) is simplified leading to the following limit in the size of the time step </p><p>If h Ã i &lt; 0 in the same subcritical case, the reduction in the time step is:</p><formula xml:id="formula_159">Dt 6 Dt Ã ; Dt Ã ¼ v i 2 k1 k h n i h n i À h Ã i :<label>ð147Þ</label></formula><p>It is possible to find regions with negative values of water depth near wet/dry interfaces with discontinuous bed level.</p><p>According to (146) the time step becomes nil in those cases. To ensure positivity and conservation in the solution for all cases, the Godunov's method for the linear case is formulated as follows:</p><formula xml:id="formula_160">U nþ1 i ¼ U n i À X NE k¼1 ðdEn À TnÞ À i;k Dtl k A i ;<label>ð148Þ</label></formula><p>where the fluxes in a general intercell edge k are computed as follows:</p><formula xml:id="formula_161">If h n j ¼ 0 and h ÃÃÃ j &lt; 0 set: ðdEn À TnÞ À i;k ¼ ðdEn À TnÞ k ðdEn À TnÞ À j;k ¼ 0:<label>ð149Þ</label></formula><formula xml:id="formula_162">If h n i ¼ 0 and h Ã i &lt; 0 set: ðdEn À TnÞ À j;k ¼ ðdEn À TnÞ k ðdEn À TnÞ À i;k ¼ 0:<label>ð150Þ</label></formula><p>Otherwise set: &lt; 0, although in these cases the cell averaging in the Godunov method avoids the appearance of negative values of h, as the source term does not participate in the updating of the water depth. In consequence the stability region becomes: Dt 6 minðDt ÃÃÃ ; Dt Ã ; Dt kÞ ifð k1k3 Þ k &lt; 0:</p><formula xml:id="formula_163">ðdEn À TnÞ À i;k ¼ X N k m¼1 ð kÀ ha ẽÞ m k ; ðdEn À TnÞ À j;k ¼ ðdEn À TnÞ þ i;k ¼ X N k m¼1 ð kþ ha ẽÞ m k :<label>ð151Þ</label></formula><formula xml:id="formula_164">Dt k otherwise; (<label>ð152Þ</label></formula><p>where Dt ÃÃÃ is defined as in (146) if h ÃÃÃ j &lt; 0 and h n j -0 and Dt Ã is defined as in (147) if h Ã i &lt; 0 and h n i -0. To avoid unphysical results derived from the linearization, the version of the Harten-Hyman entropy fix <ref type="bibr" target="#b17">[18]</ref> is applied. In the case of left transonic rarefaction k 1 i &lt; 0 &lt; k 1 j , with k i ¼ kðU i Þ and k j ¼ kðU j Þ, the initial jump associated to e k 1 k is decomposed into two new jumps,</p><formula xml:id="formula_165">k 1 k ¼ k 1 i k 1 j À k1 k 1 j À k 1 i ; k1 k ¼ k 1 j k1 k À k 1 i k 1 j À k 1 i ; b 1 k ¼ b 1 ; b1 k ¼ 0;<label>ð153Þ</label></formula><formula xml:id="formula_166">with k 1 k þ k1 k ¼ k1 k and b 1 k þ b1 k ¼ b 1</formula><p>k , preserving the original value of the state U Ã i and, in consequence, the stability region in (152). For a right transonic rarefaction k i &lt; 0 &lt; k 3 j , the entropy fix procedure is entirely analogous and the single jump in k3 k is split into two smaller jumps k 3 k and k3</p><formula xml:id="formula_167">k k 3 k ¼ k 3 j k3 k À k 3 i k 3 j À k 3 i ; k3 k ¼ k 3 i k 3 j À k3 k k 3 j À k 3 i ; b 3 k ¼ b 3 ; b3 k ¼ 0;<label>ð154Þ</label></formula><formula xml:id="formula_168">with k 3 k þ k3 k ¼ k3 k and b 3 k þ b3 k ¼ b 3</formula><p>k , preserving the original value of the state U ÃÃÃ i and in consequence the stability region in (152).</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.3.">Integration of the source term</head><p>Following the unified discretization in <ref type="bibr" target="#b4">[5]</ref> the non-conservative term ðTnÞ k in (119) at a cell edge is written <ref type="bibr" target="#b12">[13]</ref> as: Fig. <ref type="figure" target="#fig_35">29</ref>. Exact solution (-) and computed solution (À À) for for velocity v at (a) t ¼ T=4, (b) t ¼ T=2, (c) t ¼ 3T=4 and (d) at t ¼ T.</p><formula xml:id="formula_169">ðTnÞ k ¼ 0 p b q w À s b q w n x p b q w À s b q w n y 0 B B @ 1 C C A k ;<label>ð155Þ</label></formula><p>where p b q w and s b q w attend to the pressure and friction exerted on the bed respectively. In this work the following expression for the thrust term p b q w is proposed: </p><formula xml:id="formula_170">p b q w k ¼ max p b q w a ; p b</formula><formula xml:id="formula_171">j if dz &lt; 0; &amp; dz 0 ¼ h i if dz P 0 and d i &lt; z j ;</formula><p>h j if dz &lt; 0 and d j &lt; z i ;</p><p>dz otherwise:</p><formula xml:id="formula_172">8 &gt; &lt; &gt; :<label>ð158Þ</label></formula><p>The discretization of the friction term based on <ref type="bibr" target="#b11">[12]</ref> is applied</p><formula xml:id="formula_173">s b q w k ¼ gð hS f Þ k d n ; S f ;k ¼ n 2 ũnj ũj maxðh i ; h j Þ 4=3 ! k ;<label>ð159Þ</label></formula><p>with d n the normal distance between neighbor cell centers.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.4.">Reconstruction of the approximate solution b</head><p>Uðx 0 ; tÞ</p><p>The previous requirements on the of the numerical solution paying attention to the source terms can lead to extremely small values of Dt, as Dt ÃÃÃ or Dt Ã can be various orders of magnitude smaller than Dt k. This can be avoided by means of a reconstruction of the approximate solution b</p><p>Uðx 0 ; tÞ. The strategy proposed here is based on enforcing positive values of h Ã i and h ÃÃ j when they become negative by reducing the numerical source term instead of reducing the time step size. Considering that ẽ1</p><formula xml:id="formula_174">1 ¼ 1, positive values of h Ã i require that h Ã i ¼ h n i þ a 1 k À b k 1 k P 0<label>ð160Þ</label></formula><p>leading to the following limit over b</p><formula xml:id="formula_175">1 b 1 k P b 1 min ; b 1 min ¼ À h n i þ a 1 k À Á j k1 k j:<label>ð161Þ</label></formula><p>As ẽ2</p><formula xml:id="formula_176">1 ¼ 0; h ÃÃ j ¼ h ÃÃÃ j</formula><p>and considering that ẽ3</p><formula xml:id="formula_177">1 ¼ 1, to obtain positive values of h ÃÃÃ i it is necessary that h ÃÃÃ j ¼ h n j À a 3 k þ b k 3 k P 0<label>ð162Þ</label></formula><p>and a limit over b 3 appears b</p><formula xml:id="formula_178">3 k P b 3 min ; b 3 min ¼ À h n j À a 3 k k3 k :<label>ð163Þ</label></formula><p>The reconstruction proposed in this work will be applied only to subcritical wet/wet RP, as in dry/wet RP the appearance of negative values of h</p><formula xml:id="formula_179">Ã i or h ÃÃÃ j</formula><p>in the approximate solution is helpful to provide a correct tracking of the flooding advance, and in supercritical cases positivity of the solution is guaranteed. Also cases where both h Ã i &lt; 0 and h ÃÃÃ j &lt; 0 are omitted. In the case that h </p><p>In the case that h </p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="4.5.">2D application</head><p>The following test case is motivated by the necessity of checking the performance of reconstruction of the solution proposed in the previous section in two dimensional problems with transient boundaries dominated by the nonconservative terms and with analytical solution. Consider the frictionless parabolic topography defined by the depth function <ref type="bibr" target="#b16">[17]</ref> zðx; yÞ ¼ Àz</p><formula xml:id="formula_182">0 1 À x 2 þ y 2 a 2<label>ð166Þ</label></formula><p>together with the periodic analytical solution of the two-dimensional shallow water equations stated in:</p><p>hðx; y; tÞ ¼ max 0; rz 0 a 2 ð2x cosðxtÞ þ 2y sinðxtÞ À rÞ À zðx; yÞ ; uðx; y; tÞ ¼ rx sinðxtÞ; vðx; y; tÞ ¼ rx cosðxtÞ;</p><p>where u and v are the velocities in the x and y directions, and x ¼ ffiffiffiffiffiffiffiffiffi ffi 2gz 0 p =a. Having shown the performance of the proposed scheme in cases with discontinuous source terms, this test case is useful to explore the limits of the approximated Riemann solver in two dimensional problems where the dry/wet boundaries are present.</p><p>The values a ¼ 1000; r ¼ 300; g ¼ 9:80665 and z 0 ¼ 10 have been considered for this test, leading to a period T = 448.57 s.</p><p>The computations have been performed using a triangular mesh built by drawing the diagonals on a quadrilateral grid with cell side l = 15 in a squared domain 3000 Â 3000 m and using CFL = 1.0. Comparisons along a radius between the numerical and the analytical free surfaces at different times are shown in Figs. <ref type="figure" target="#fig_35">26</ref> and<ref type="figure" target="#fig_35">27</ref>. The planar form of the free surface is maintained throughout the computation. In Figs. 28 and 29 comparisons for both the u and v velocities at time t ¼ T are shown. The prediction of the velocities is good at all times in the cells covered by water according to the exact solution. The main discrepancies appear in the cells where the transient exchange of water is taking place with a certain lag time with respect to the exact solution. This example is representative of the time step size reduction imposed by the required positivity over the intermediate water depths in all the RP's. Figs. 30 and 31 shows the time history of the time step size automatically generated by the method following the conditions (152) ðÀ ÀÞ. The positivity condition requires that the time step is reduced by three orders of magnitud in average along the total computational time. On the other hand, using the reconstruction based on limiting the discrete source term as in (164) and (164) enables a good quality solution at a constant time step size despite the transient flow.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head n="5.">Conclusions</head><p>In this paper new approximate Riemann solvers problems for equations and systems with source terms have been presented by adding one extra wave associated to the source term. The approximate solution is assumed discontinuous in x = 0 and therefore the flux cannot be correctly evaluated assuming the existence of a single value at that location. The method is specifically designed to satisfy the integral formulation. The method has not been designed specifically for source terms which provide some sort of balance with the flux derivatives so that the same techniques can easily be applied to all kind of source terms.</p><p>These wave solutions have been used to rebuild Roe's solver for the discretization of equations with source terms interpreted as non-conservative equations. The approach is based on the wave propagation algorithm in which waves arising in Riemann solutions are directly re-averaged onto adjacent cells in order to update the numerical solution. The method is applicable to both equations in the form of a conservation law as well as those where there is not a flux function (nonconservative equations). The careful procedure of wave averaging in the adjacent cells is the only way to control the stability region of the resulting method as well as the positivity of the variables in all kind of flow conditions. This is the starting point to explore different approximations to the integral source terms in the search for the best properties in each case.</p><p>The discretisation proposed is different from the work of many previous authors, who approximated their source terms in a manner which took into account the flux discretisation and, as a consequence, allowed the numerical model to maintain specific equilibria. Previous work dealing with the shallow water system has devoted particular attention to the special case of still water, and the schemes have been constructed so that they maintain this state. In this work, the emphasis is put on a more general idea that is based in the knowledge of non-trivial exact solutions. In fact, the improved accuracy of the new upwind discretisation of the source terms is shown in the approximation of other unsteady exact solutions, particularly in one dimension. Three approaches are discussed for the integral source term, all of them able to fit the trivial quiescent water steady state but different in other cases.</p><p>The effectiveness of these techniques has been illustrated, in the scalar case, for the Burgers' equation with source terms and also for systems of equations using the one-and two-dimensional shallow water equations, in which source terms are used to model variations in the bed topography and channel friction. This has been shown by comparison with a selection of test cases for which exact solutions are available.</p><p>Different methods of integrating source terms, which all respect the classical C-property for water at rest, have been shown to provide different behaviour in specifiec configurations when the water velocity is not equal to zero. Only one of them is recommended as it represents the best compromise in all kind of flows.</p><p>The work proposes two modifications over the original Roe's scheme: First, a reformulation of the stability condition that generalizes the classical CFL condition by including the influence of the source terms and the initial conditions in order to avoid the appearance of negative water depth values. Second, a redefinition of the numerical scheme in some particular cases in order to further prevent negative water depth values with independence of the time step. These modifications lead certainly to a considerable CPU time increase in complicated cases. It must be stressed, however, that the modifications are proposed precisely to make the basic method able to cope with complicated cases.</p><p>The careful design of the numerical scheme for the equations with source terms requires severe restriction of the allowable time step compatible with numerical stability and positivity in some cases. It is possible to avoid this by limiting the amount of numerical source term involved instead of limiting the time step and leading to more efficient computations. This part does not increase the CPU time but, on the contrary, is included to reduce it. It has been shown that, in combination with the source term approximation, the method produces accurate solutions for a wide variety of timedependent test cases. &gt; &gt; &gt; &gt; &lt; &gt; &gt; &gt; &gt; : ð182Þ</p><p>with  ;</p><formula xml:id="formula_184">U Ã i ðU iþ1 ; U i ; S iþ1=2 Þ ¼ U n i þ</formula><formula xml:id="formula_185">ðhuÞ Ã i ¼ ðhuÞ ÃÃ iþ1 ¼ k2k1 ðh iþ1 À h i Þ þ k2 ðhuÞ i À k1 ðhuÞ iþ1 k2 À k1 þ b 2<label>ð184Þ</label></formula><p>That is, the inner solutions in (182) conserve the same value of hu Ã from left to right, and from right to left, but this symmetry disappears for h Ã .</p><p>In the supercritical case, considering ũ &gt; 0the solution b Uðx; tÞ , Figs. 34 and 35, is given by: b Uðx; tÞ ¼</p><formula xml:id="formula_186">U n i if x &lt; 0; U Ã iþ1 if</formula><p>x &gt; 0 and x À k1 t &lt; 0;</p><p>U ÃÃ iþ1 if x À k1 t &gt; 0 and x À k2 t &lt; 0;</p><formula xml:id="formula_187">U n iþ1 if x À k2 t &gt; 0; 8 &gt; &gt; &gt; &gt; &lt; &gt; &gt; &gt; &gt; :<label>ð185Þ</label></formula><p>with U ÃÃ iþ1 defined as in (183) and</p><formula xml:id="formula_188">U Ã iþ1 ðU iþ1 ; U i ; S iþ1=2 Þ ¼ U ÃÃ iþ1 À ðha ẽÞ 1 iþ1=2<label>ð186Þ</label></formula><p>characterized by</p><formula xml:id="formula_189">h n i -h Ã iþ1 ðhuÞ n i ¼ ðhuÞ Ã iþ1<label>ð187Þ</label></formula><p>In the supercritical case, considering ũ &lt; 0 the solution b Uðx; tÞ, is given by: b Uðx; tÞ ¼</p><formula xml:id="formula_190">U n i if x À k1 t &lt; 0 U Ã i if x À k1 t &gt; 0 and x À k2 t &lt; 0 U ÃÃ i if x À k2 t &gt; 0 and x &lt; 0 U n iþ1 if x &gt; 0 8 &gt; &gt; &gt; &gt; &lt; &gt; &gt; &gt; &gt; :<label>ð188Þ</label></formula><p>with U Ã i defined as in (182) and Letting aside considerations regarding the friction term, it is useful to study the effect of the bed slope in the solution of a dam break wave over a bottom step, where the bed discontinuity behaves as a stationary shock <ref type="bibr" target="#b1">[2]</ref>. The initial data are given by hðx;</p><formula xml:id="formula_191">U ÃÃ i ðU iþ1 ; U i ; S iþ1=2 Þ ¼ U Ã i þ</formula><formula xml:id="formula_192">0Þ ¼ h o ðxÞ ¼ h L if x &lt; 0 h R if x &gt; 0 &amp; uðx; 0Þ ¼ u o ðxÞ ¼ 0 zðxÞ ¼ z L if x &lt; 0 z R if x &gt; 0 &amp;<label>ð191Þ</label></formula><p>The exact solution, as depicted in Fig. <ref type="figure" target="#fig_34">36</ref>, consists of left moving wave rarefaction, a steady jump in x = 0 and a right moving shock with a constant speed S m . The rarefaction moves upstream at a velocity k 1 ðU L Þ connecting with a new state U Ã L , that can be defined by means of the Riemann invariant across the wave and to be physically acceptable the following entropy relation which must be satisfied</p><formula xml:id="formula_193">k 1 ðU L Þ &lt; k 1 U Ã L À Á<label>ð193Þ</label></formula><p>The steady discontinuity at x = 0 connects two states, U Ã L and U Ã R . As temporal terms vanish</p><formula xml:id="formula_194">dF dx ¼ S<label>ð194Þ</label></formula><p>Integrating between x ¼ 0 þ and x ¼ 0 À the value of U Ã R is given by:</p><formula xml:id="formula_195">ðhuÞ Ã R À ðhuÞ Ã L ¼ 0 hu 2 þ g h 2 2 ! Ã R À hu 2 þ g h 2 2 ! Ã L ¼ Z þ0 À0 p b q w dx<label>ð195Þ</label></formula><p>The second equation in (195) involves the pressure on the vertical step in x = 0. Its evaluation actually requires to know the two-dimensional flow around the bottom step, which is another scientific topic. In a one-dimensional frame this closure- problem may be faced by assuming that the pressure distribution is hydrostatic over the vertical step. The pressure term is <ref type="bibr" target="#b15">[16]</ref> Z þ0 À0</p><formula xml:id="formula_196">p b q w dx ¼ Àg h j À jz R À z L j 2 ðz R À z L Þ<label>ð196Þ</label></formula><p>where</p><formula xml:id="formula_197">j ¼ L if z L 6 z R R if zL &gt; z R &amp;<label>ð197Þ</label></formula><p>According to <ref type="bibr" target="#b2">[3]</ref> in order to exclude the multiplicity of solutions of (195), the entropy condition must be enforced; that is, total energy dissipates across the stationary shock. The equations valid across the shock discontinuity propagating at a constant speed S m , between constant states U Ã R and U R can be derived from system (40). System of laws provide the following relation:</p><formula xml:id="formula_198">ðFðU R Þ À FðU Ã R ÞÞ ¼ S m ðU R À U Ã R Þ<label>ð198Þ</label></formula><p>and therefore</p><formula xml:id="formula_199">ðhuÞ R À ðhuÞ Ã R ¼ S m ðh R À h Ã R Þ hu 2 þ g h 2 2 ! R À hu 2 þ g h 2 2 ! Ã R ¼ S m ðhuÞ R À ðhuÞ Ã R À Á<label>ð199Þ</label></formula><p>A final remark concerns the entropy relation which must be satisfied in the case of a right moving shock in order to be physically acceptable:</p><formula xml:id="formula_200">k 2 U Ã R À Á &gt; S m &gt; k 2 ðU R Þ<label>ð200Þ</label></formula><p>Appendix D. A four wave approximate Riemann solution Four approximate solutions that satisfy (122) are proposed. These solutions for b Uðx 0 ; tÞ are governed by the celerities in e K k and each one consists of five regions connected by four waves, one of them steady.</p><p>In the subcritical case with ũn &gt; 0, the proposed weak solution is: b Uðx 0 ; tÞ ¼</p><formula xml:id="formula_201">U n i if x 0 À k1 t &lt; 0 U Ã i if</formula><p>x 0 À k1 t &gt; 0 and x 0 &lt; 0 U ÃÃ j if x 0 &gt; 0 and x 0 À k2 t &lt; 0 U ÃÃÃ j if x 0 À k2 t &gt; 0 and x 0 À k3 t &lt; 0</p><formula xml:id="formula_202">U n j if x 0 À k3 t &gt; 0 8 &gt; &gt; &gt; &gt; &gt; &gt; &gt; &lt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; :<label>ð201Þ</label></formula><p>with  </p><formula xml:id="formula_203">U Ã i ðU j ; U i ; ðTnÞ k Þ ¼ U n i þ ðha ẽÞ 1 k U ÃÃÃ j ðU j ; U i ; ðTnÞ k Þ ¼ U n j À ha ẽ ð Þ 3 k U ÃÃ j ðU j ; U i ; ðTnÞ k Þ ¼ U ÃÃÃ</formula></div><figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_0"><head>Fig. 1 .Fig. 2 .</head><label>12</label><figDesc>Fig. 1. Approximate solution for ûðx; tÞ.</figDesc><graphic coords="4,211.16,373.04,117.63,117.31" type="bitmap" /></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_1"><head>Fig. 3 .</head><label>3</label><figDesc>Fig. 3. (a) Exact solution (-) and computed solutions at t = 15 for test case 1, and (b) exact solution and computed solutions at t = 15 for test case 2, using approaches s a ðÀ ÀÞ; s b ðÀ ÀÞ and s c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_2"><head>Fig. 4 .</head><label>4</label><figDesc>Fig. 4. (a) Exact solution (-) and computed solutions at t = 15 for test case 3, and (b) exact solution and computed solutions at t = 15 for test case 4, using approaches s a ðÀ ÀÞ; s b ðÀ ÀÞ and s c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_3"><head>Fig. 5 .</head><label>5</label><figDesc>Fig. 5. (a) Exact solution (-) and computed solutions at t = 15 for test case 5, and (b) exact solution and computed solutions at t = 15 for test case 6, using approaches s a ðÀ ÀÞ; s b ðÀ ÀÞ and s c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_4"><head>Fig. 6 .</head><label>6</label><figDesc>Fig.6. (a) Exact solution (-) and computed solutions at t = 15 using numerical scheme (22), and (b) exact solution and computed solutions for numerical scheme (28), at t = 15 for test case 7, using approaches s a ðÀ ÀÞ; s b ðÀ ÀÞ and s c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_5"><head>3. 1 .</head><label>1</label><figDesc>Approximate solution of the Riemann problemGiven a Riemann problem for (41) with initial values U L ; U R , a time interval [0, 1] and a space interval [ÀX, X] , where ÀX 6 k min ; X P k max</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_6"><head>Fig. 7 .</head><label>7</label><figDesc>Fig. 7. (a) Exact solution(-)  and computed solutions at t = 15 using numerical scheme (22), and (b) exact solution and computed solutions for numerical scheme (28), at t = 15 for test case 8, using approaches s a ðÀ ÀÞ; s b ðÀ ÀÞ and s c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_7"><head>Fig. 8 .Fig. 9 .</head><label>89</label><figDesc>Fig. 8. Control volume in the Godunov method.</figDesc><graphic coords="12,180.02,66.26,184.39,126.97" type="bitmap" /></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_8"><head>and k 1 &lt;</head><label>1</label><figDesc>0 and b k 1 &gt; 0 by definition. This idea can be applied to the decomposition of the source term associated to b 1 into two new values, b 1 and b b 1 . Their definition has to be done enforcing a conservative splitting of the source terms, b</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_9"><head>Ã</head><label></label><figDesc>i or h ÃÃ iþ1 in the approximate solution is helpful to provide a correct tracking of the flooding advance, and in supercritical cases the cell averaging of the weak solutions ensures positivity of the solution. Also cases where both h Ã i &lt; 0 and h ÃÃ iþ1 &lt; 0 are omitted.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_10"><head>Fig. 10 . 1 ¼ b 1 minif À b 1 min P b 2 min b 1 otherwise ( ; b 2 ¼</head><label>101112</label><figDesc>Fig. 10. Solution bUðx; tÞ in case of static equilibrium.</figDesc><graphic coords="15,206.90,65.96,117.39,106.93" type="bitmap" /></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_11"><head>Fig. 11 .</head><label>11</label><figDesc>Fig. 11. Test case 1: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_12"><head>Fig. 12 .</head><label>12</label><figDesc>Fig. 12. Test case 2: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_13"><head>Fig. 13 .</head><label>13</label><figDesc>Fig. 13. Test case 3: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_14"><head>Fig. 14 .</head><label>14</label><figDesc>Fig. 14. Test case 4: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_15"><head>Fig. 15 .</head><label>15</label><figDesc>Fig. 15. Test case 5: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_16"><head>Fig. 16 .</head><label>16</label><figDesc>Fig. 16. Test case 6: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_17"><head>Fig. 17 .</head><label>17</label><figDesc>Fig. 17. Test case 7: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ and ðp b =q w Þ c ðÀMÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_18"><head>Fig. 18 .</head><label>18</label><figDesc>Fig. 18. Test case 8: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ; ðp b =q w Þ c ðÀMÀÞ and ðp b =q w Þ c;w ðÀNÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_19"><head>Fig. 19 .</head><label>19</label><figDesc>Fig. 19. Test case 9: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ; ðp b =q w Þ c ðÀMÀÞ and ðp b =q w Þ c;w ðÀNÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_20"><head>Fig. 20 .</head><label>20</label><figDesc>Fig. 20. Test case 10: comparison between exact (-) and numerical solutions at t = 5 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ; ðp b =q w Þ c ðÀMÀÞ and ðp b =q w Þ c;w ðÀNÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_21"><head>Fig. 21 .</head><label>21</label><figDesc>Fig. 21. Test case 11: comparison between exact (-) and numerical solutions at t = 25 s obtained with approaches ðp b =q w Þ a ðÀ ÀÞ; ðp b =q w Þ b ðÀ ÀÞ; ðp b =q w Þ c ðÀMÀÞ and ðp b =q w Þ c;w ðÀNÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_22"><head>Fig. 22 .</head><label>22</label><figDesc>Fig. 22. Plot of the numerical water level surface and water discharge using approach ðp b =q w Þ c ðÀ ÀÞ and ðp b =q w Þ c;w ðÀMÀÞ at times: (a) and (b) t = 45, (c) and (d) t = 50, (e) and (f) t = 55 s.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_23"><head>Fig. 23 .Fig. 24 .</head><label>2324</label><figDesc>Fig. 23. Plot of the numerical water level surface and water discharge using the reconstructed weak solution with approach ðp b =q w Þ c ðÀMÀÞ and with approach ðp b =q w Þ c;w ðÀ ÀÞ at time t = 55 s.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_24"><head>Fig. 26 .</head><label>26</label><figDesc>Fig. 26. Water level surface at (a) t ¼ 0, (b) t ¼ T=4, (c) t ¼ T=2, (d) t ¼ 3T=4 and (e) at t ¼ T.</figDesc><graphic coords="29,42.52,221.33,453.60,451.79" type="bitmap" /></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_25"><head>Fig. 27 .Dt 6</head><label>276</label><figDesc>Fig.27. Exact solution (-) and computed solution (À À) for the water level surface at (a) t ¼ T=4, (b) t ¼ T=2, (c) t ¼ 3T=4 and (d) at t ¼ T.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_26"><head>Fig. 28 .</head><label>28</label><figDesc>Fig.28. Exact solution (-) and computed solution (À À) for for velocity u at (a) t T=4, (b) t ¼ T=2, (c) t ¼ 3T=4 and (d) at t ¼ T.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_27"><head></head><label></label><figDesc>if dz P 0;</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_28"><head>Ãi¼ b 1 min if Àb 1 min P b 3 min b 1 otherwise ( b 3 ¼</head><label>13</label><figDesc>&lt; 0 and h ÃÃÃ j &gt; 0 and Dt Ã &lt; Dt k, the new value of b 1 is redefined ensuring that h ÃÃÃ j remains positive or null, as to ensure conservation b 3 must be replaced by the new value of Àb 1 , then b 1 Àb 1 :</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_29"><head>Ãib 1 ¼</head><label>1</label><figDesc>&gt; 0 and h ÃÃÃ j &lt; 0 and Dt ÃÃÃ &lt; Dt k, the new value of b 3 is redefined ensuring that h Ã i remains positive or null, as to ensure conservation b 1 must be replaced by the new value of Àb 3 , then Àb 3 :</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_30"><head>Fig. 30 .</head><label>30</label><figDesc>Fig. 30. Time step evolution in time for the original weak solution ðÀ ÀÞ and computed for the reconstructed weak solution ðÀ ÀÞ.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_31"><head>Fig. 32 .Fig. 33 .</head><label>3233</label><figDesc>Fig. 32. Rarefaction wave solution of the Riemann problem.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_32"><head>Fig.Fig. 35 .</head><label>35</label><figDesc>Fig. Values of the solution U in each wedge of the ðx; tÞ plane for the supercritical case, ũ &gt; 0.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_34"><head>Fig. 36 .</head><label>36</label><figDesc>Fig. 36. Exact solution of the dam break problem.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_35"><head>j À ðha ẽÞ 2 k</head><label>2</label><figDesc>ð202Þas depicted in Figs.37 and 38.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" xml:id="fig_36"><head>Fig. 37 .</head><label>37</label><figDesc>Fig.37. Values of the solution U in each wedge of the ðx 0 ; tÞ plane for the subcritical case, ũn &gt; 0.</figDesc></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_0"><head>Table 1</head><label>1</label><figDesc>Summary of test cases.</figDesc><table><row><cell>Test case</cell><cell>u L</cell><cell>u R</cell><cell>z L</cell><cell>z R</cell><cell>u L f</cell></row><row><cell>1</cell><cell>2.0</cell><cell>1.0</cell><cell>0.0</cell><cell>0.5</cell><cell>1.5</cell></row><row><cell>2</cell><cell>2.0</cell><cell>1.0</cell><cell>0.0</cell><cell>À0.5</cell><cell>2.5</cell></row><row><cell>3</cell><cell>1.0</cell><cell>2.0</cell><cell>0.5</cell><cell>0.0</cell><cell>1.5</cell></row><row><cell>4</cell><cell>1.0</cell><cell>2.0</cell><cell>0.0</cell><cell>0.5</cell><cell>0.5</cell></row><row><cell>5</cell><cell>2.0</cell><cell>1.0</cell><cell>0.0</cell><cell>1.5</cell><cell>0.5</cell></row><row><cell>6</cell><cell>1.0</cell><cell>2.0</cell><cell>1.5</cell><cell>0.0</cell><cell>2.5</cell></row><row><cell>7</cell><cell>1.0</cell><cell>2.0</cell><cell>0.0</cell><cell>2.0</cell><cell>À1.0</cell></row><row><cell>8</cell><cell>2.0</cell><cell>0.0</cell><cell>0.0</cell><cell>2.5</cell><cell>À0.5</cell></row></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_1"><head>Table 2</head><label>2</label><figDesc>Summary of test cases.</figDesc><table><row><cell>Test case</cell><cell>h L</cell><cell>h R</cell><cell>u L</cell><cell>u R</cell><cell>z L</cell><cell>z R</cell></row><row><cell>1</cell><cell>1.0</cell><cell>0.30179953</cell><cell>0.0</cell><cell>0.0</cell><cell>0.0</cell><cell>0.05</cell></row><row><cell>2</cell><cell>4.0</cell><cell>0.50537954</cell><cell>0.1</cell><cell>0.0</cell><cell>0.0</cell><cell>1.5</cell></row><row><cell>3</cell><cell>2.5</cell><cell>2.49977381</cell><cell>1.5</cell><cell>0.0</cell><cell>0.0</cell><cell>0.25</cell></row><row><cell>4</cell><cell>1.5</cell><cell>0.16664757</cell><cell>2.0</cell><cell>0.0</cell><cell>0.0</cell><cell>2.0</cell></row><row><cell>5</cell><cell>1.0</cell><cell>0.04112267</cell><cell>0.2</cell><cell>0.0</cell><cell>0.25</cell><cell>0.0</cell></row><row><cell>6</cell><cell>0.6</cell><cell>0.02599708</cell><cell>0.35</cell><cell>0.0</cell><cell>1.2</cell><cell>0.0</cell></row><row><cell>7</cell><cell>1.1</cell><cell>0.49457729</cell><cell>4.9</cell><cell>6.50</cell><cell>0.2</cell><cell>0.0</cell></row><row><cell>8</cell><cell>1.5</cell><cell>0.0</cell><cell>2.2862</cell><cell>0.0</cell><cell>0.</cell><cell></cell></row></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_3"><head></head><label></label><figDesc>where e K k is a diagonal matrix with eigenvalues km;Ã</figDesc><table /><note><p>k in the main diagonal and H k is a diagonal matrix with h m k in the main diagonal:</p></note></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_4"><head>Table 3</head><label>3</label><figDesc>Numerical limits for zR.</figDesc><table><row><cell>Test case</cell><cell>h L;0</cell><cell>z a R</cell><cell>z b R</cell><cell>z c R</cell><cell>z c;w R</cell></row><row><cell>8</cell><cell>2.50000452</cell><cell>3.2</cell><cell>-</cell><cell>3.2</cell><cell>2.51</cell></row><row><cell>9</cell><cell>3.60001180</cell><cell>4.7</cell><cell>-</cell><cell>4.7</cell><cell>3.61</cell></row><row><cell>10</cell><cell>0.68136277</cell><cell>0.8</cell><cell>-</cell><cell>0.8</cell><cell>0.68</cell></row><row><cell>11</cell><cell>0.18160310</cell><cell>0.18</cell><cell>-</cell><cell>0.18</cell><cell>0.18</cell></row></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_5"><head></head><label></label><figDesc>Uðx 0 ; tÞ are governed by the celerities in e K k and each one consists of five regions connected by four waves, one of them steady. The details are provided in Appendix D.</figDesc><table /><note><p><p>4.2.1. A four wave approximate Riemann solution</p>Four approximate solutions that satisfy (122) are proposed. These solutions for b</p></note></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_6"><head></head><label></label><figDesc>Pj e KjP À1 dUÞ k ð141Þ</figDesc><table><row><cell>and</cell></row><row><cell>ðTnÞ AE k ¼ ðPI AE P À1 ÞðTnÞ k</cell></row></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_7"><head></head><label></label><figDesc>ðha ẽÞ 1 iþ1=2 ; U ÃÃ iþ1 ðU iþ1 ; U i ; S iþ1=2 Þ ¼ U n iþ1 À ðha ẽÞ 2</figDesc><table><row><cell></cell><cell>ð183Þ</cell></row><row><cell></cell><cell>iþ1=2</cell></row><row><cell cols="2">characterized by</cell></row><row><cell>h</cell><cell>Ã i -h ÃÃ iþ1</cell></row></table></figure>
<figure xmlns="http://www.tei-c.org/ns/1.0" type="table" xml:id="tab_8"><head></head><label></label><figDesc>ðha ẽÞ 2</figDesc><table><row><cell>iþ1=2</cell><cell>ð189Þ</cell></row><row><cell>characterized by</cell><cell></cell></row><row><cell>h ðhuÞ ÃÃ ÃÃ i -h n iþ1 i ¼ ðhuÞ n iþ1</cell><cell>ð190Þ</cell></row><row><cell>Appendix C. Dambreak over a bottom step</cell><cell></cell></row></table></figure>
			<note xmlns="http://www.tei-c.org/ns/1.0" place="foot" xml:id="foot_0"><p>This case corresponds to a RP with a source function.</p></note>
			<note xmlns="http://www.tei-c.org/ns/1.0" place="foot" xml:id="foot_1"><p>J. Murillo, P. García-Navarro / Journal of Computational Physics 229 (2010) 4327-4368</p></note>
			<note xmlns="http://www.tei-c.org/ns/1.0" place="foot" xml:id="foot_2"><p>J. Murillo, P. García-Navarro / Journal of Computational Physics 229 (2010) 4327-4368</p></note>
		</body>
		<back>

			<div type="acknowledgement">
<div xmlns="http://www.tei-c.org/ns/1.0"><head>Acknowledgements</head><p>This work has been partially funded by the Spanish Ministry of Science and Technology under research project CGL2008-05153-C02-02.</p></div>
			</div>

			<div type="annex">
<div xmlns="http://www.tei-c.org/ns/1.0"><p>Appendix A. Exact solution to Burgers' equation with source terms Consider Burgers' equation including source terms as proposed in <ref type="bibr" target="#b10">[11]</ref>:</p><p>with the initial data uðx;</p><p>A.1. Shock relations Shock relations are moving discontinuities travelling at speed a that separate two general constant states, u Ã L and u Ã R <ref type="bibr" target="#b17">[18,</ref><ref type="bibr" target="#b8">9]</ref>. In the homogeneous case they occur always when u Ã L &gt; u Ã R if a is positive. Assuming that u L P 0 and u R P 0 there is a weak solution consisting of a steady discontinuity at x=0 plus a linear shock traveling with velocity a, connecting an intermediate state u Ã with u R :</p><p>The presence of a source term in (168) leads to a standing discontinuity in x = 0. The value of u Ã can be derived from the steady state solution of Eq. ( <ref type="formula">168</ref>):</p><p>with Dz ¼ z R À z L . The other discontinuity, moving with a shock speed a, must satisfy the Rankine-Hugoniot jump condition <ref type="bibr" target="#b17">[18,</ref><ref type="bibr" target="#b8">9]</ref>:</p><p>leading to a celerity equal to:</p><p>The parameter f measures the relative influence of the source term over the convective term and changes the solution of the RP. There are situations in which the weak solution is not unique. The entropy condition determines the physically relevant solutions. In solution (170) it is necessary that:</p><p>and as for (168) kðuÞ ¼ u, the solution is valid if:</p><p>In the particular case f ¼ u R u L the initial RP does not change in time.</p></div>
<div xmlns="http://www.tei-c.org/ns/1.0"><head>A.2. Rarefaction waves</head><p>Rarefaction waves are weak solutions of the initial RP. Assuming that u R P 0and u L P 0, the weak self-similar solution consists of a steady discontinuity at x = 0 plus a right rarefaction wave expanding with a velocity x=t between two constant states u Ã L and u R :</p><p>The value of u Ã L can be derived considering the steady discontinuity in x = 0, as in (171)</p><p>The solution is only acceptable if the following entropy condition holds (see Fig. <ref type="figure">32</ref>):</p><p>and it is easy to check that the following limit is necessary to have a correct rarefaction solution</p><p>In the case f ¼ u R u L the solution in time is equal to the initial RP. Considering that our RP is defined assuming u R P 0 and u L P 0, a positive solution characterized by values of uðx; tÞ P 0 is enforced if</p><p>Appendix B. A three wave approximate Riemann solution</p><p>Depending on the flow conditions, three approximate solutions that satisfy (49), are proposed. The solutions for b Uðx; tÞ are governed by the celerities in e K iþ1=2 and each one consists of four regions. In the subcritical case, Fig. <ref type="figure">33</ref>, the solution is given by: b Uðx; tÞ ¼</p><p>In the subcritical case, considering ũn &lt; 0, the proposed weak solution is:</p><p>with</p><p>In the supercritical case, considering ũn &gt; 0, is:</p><p>and, in the supercritical case, assuming ũn &lt; 0, is: b Uðx 0 ; tÞ ¼</p><p>x 0 À k1 t &gt; 0 and x 0 À k2 t &lt; 0 U ÃÃ i if x 0 À k2 t &gt; 0 and x 0 À k3 t &lt; 0 U ÃÃÃ j if x 0 À k3 t &gt; 0 and x 0 &lt; 0</p></div>			</div>
			<div type="references">

				<listBibl>

<biblStruct xml:id="b0">
	<analytic>
		<title level="a" type="main">Model for flood propagation on initially dry land</title>
		<author>
			<persName><forename type="first">A</forename><forename type="middle">A</forename><surname>Akanbi</surname></persName>
		</author>
		<author>
			<persName><forename type="first">N</forename><forename type="middle">D</forename><surname>Katopodes</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Hydraul. Eng</title>
		<imprint>
			<biblScope unit="volume">114</biblScope>
			<biblScope unit="page" from="689" to="706" />
			<date type="published" when="1987">1987</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b1">
	<analytic>
		<title level="a" type="main">Exact solutions to the Riemann problem of the shallow water equations with a bottom step</title>
		<author>
			<persName><forename type="first">F</forename><surname>Alcrudo</surname></persName>
		</author>
		<author>
			<persName><forename type="first">F</forename><surname>Benkhaldoun</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comput. Fluids</title>
		<imprint>
			<biblScope unit="volume">30</biblScope>
			<biblScope unit="page">643671</biblScope>
			<date type="published" when="2001">2001</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b2">
	<analytic>
		<title level="a" type="main">Exact solution of the Riemann problem for the shallow water equations with discontinuous bottom geometry</title>
		<author>
			<persName><forename type="first">R</forename><surname>Bernetti</surname></persName>
		</author>
		<author>
			<persName><forename type="first">V</forename><forename type="middle">A</forename><surname>Titarev</surname></persName>
		</author>
		<author>
			<persName><forename type="first">E</forename><forename type="middle">F</forename><surname>Toro</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">227</biblScope>
			<biblScope unit="page" from="3212" to="3243" />
			<date type="published" when="2008">2008</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b3">
	<analytic>
		<title level="a" type="main">Garcı ´a-Navarro, A numerical model for the flooding and drying of irregular domains</title>
		<author>
			<persName><forename type="first">P</forename><surname>Brufau</surname></persName>
		</author>
		<author>
			<persName><forename type="first">M</forename><forename type="middle">E</forename><surname>Vázquez-Cendón</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Numer. Methods Fluids</title>
		<imprint>
			<biblScope unit="volume">39</biblScope>
			<biblScope unit="page" from="247" to="275" />
			<date type="published" when="2002">2002</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b4">
	<analytic>
		<title level="a" type="main">Garcı ´a-Navarro, Efficient construction of high-resolution TVD conservative schemes for equations with source terms: application to shallow water flows</title>
		<author>
			<persName><forename type="first">J</forename><surname>Burguete</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Int. J. Numer. Methods Fluids</title>
		<imprint>
			<biblScope unit="volume">37</biblScope>
			<biblScope unit="page" from="209" to="248" />
			<date type="published" when="2001">2001</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b5">
	<analytic>
		<title level="a" type="main">On the solution of nonlinear hyperbolic differential equations by finite differences</title>
		<author>
			<persName><forename type="first">R</forename><surname>Courant</surname></persName>
		</author>
		<author>
			<persName><forename type="first">E</forename><surname>Isaacson</surname></persName>
		</author>
		<author>
			<persName><forename type="first">M</forename><surname>Rees</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Comm. Pure Appl. Maths</title>
		<imprint>
			<biblScope unit="volume">5</biblScope>
			<biblScope unit="page" from="243" to="255" />
			<date type="published" when="1952">1952</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b6">
	<analytic>
		<title level="a" type="main">Augmented Riemann solvers for the shallow water equations over variable topography with steady states and inundation</title>
		<author>
			<persName><forename type="first">D</forename><forename type="middle">L</forename><surname>George</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">227</biblScope>
			<biblScope unit="page" from="3089" to="3113" />
			<date type="published" when="2008">2008</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b7">
	<analytic>
		<title level="a" type="main">Garcı ´a-Navarro, Flux difference splitting and the balancing of source terms and flux gradients</title>
		<author>
			<persName><forename type="first">M</forename><forename type="middle">E</forename><surname>Hubbard</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">165</biblScope>
			<biblScope unit="page" from="89" to="125" />
			<date type="published" when="2000">2000</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b8">
	<analytic>
		<title level="a" type="main">Values of the solution U in each wedge of the ðx 0 ; tÞ plane for the subcritical case</title>
		<author>
			<persName><forename type="first">R</forename><forename type="middle">J</forename><surname>Leveque</surname></persName>
		</author>
		<idno>ũn &lt; 0</idno>
	</analytic>
	<monogr>
		<title level="m">Finite Volume Methods fot Hyperbolic Problems</title>
		<meeting><address><addrLine>New York</addrLine></address></meeting>
		<imprint>
			<publisher>Cambridge University Press</publisher>
			<date type="published" when="2002">2002</date>
			<biblScope unit="volume">38</biblScope>
			<biblScope unit="page">311</biblScope>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b9">
	<analytic>
		<title level="a" type="main">Numerical resolution of well-balanced shallow water equations with complex source terms</title>
		<author>
			<persName><forename type="first">Q</forename><forename type="middle">H</forename><surname>Liang</surname></persName>
		</author>
		<author>
			<persName><forename type="first">F</forename><surname>Marche</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Adv. Water Resour</title>
		<imprint>
			<biblScope unit="volume">32</biblScope>
			<biblScope unit="page" from="873" to="884" />
			<date type="published" when="2009">2009</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b10">
	<analytic>
		<title level="a" type="main">Garcı ´a-Navarro, The influence of source terms on stability, accuracy and conservation in two-dimensional shallow flow simulation using triangular finite volumes</title>
		<author>
			<persName><forename type="first">J</forename><surname>Murillo</surname></persName>
		</author>
		<author>
			<persName><forename type="first">J</forename><surname>Burguete</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename><surname>Brufau</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Int. J. Numer. Methods Fluids</title>
		<imprint>
			<biblScope unit="volume">54</biblScope>
			<biblScope unit="page" from="543" to="590" />
			<date type="published" when="2007">2007</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b11">
	<analytic>
		<title level="a" type="main">Time step restrictions for well balanced shallow water solutions in non-zero velocity steady states</title>
		<author>
			<persName><forename type="first">J</forename><surname>Murillo</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename><surname>Garcı ´a-Navarro</surname></persName>
		</author>
		<author>
			<persName><forename type="first">J</forename><surname>Burguete</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Int. J. Numer. Methods Fluids</title>
		<imprint>
			<biblScope unit="volume">56</biblScope>
			<biblScope unit="page" from="661" to="686" />
			<date type="published" when="2008">2008</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b12">
	<analytic>
		<title level="a" type="main">Conservative numerical simulation of multicomponent transport in two-dimensional unsteady shallow water flow</title>
		<author>
			<persName><forename type="first">J</forename><surname>Murillo</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename><surname>Garcı ´a-Navarro</surname></persName>
		</author>
		<author>
			<persName><forename type="first">J</forename><surname>Burguete</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">228</biblScope>
			<biblScope unit="page" from="5539" to="5573" />
			<date type="published" when="2009">2009</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b13">
	<analytic>
		<title level="a" type="main">A basis for upwind differencing of the two-dimensional unsteady Euler equations</title>
		<author>
			<persName><forename type="first">P</forename><forename type="middle">L</forename><surname>Roe</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">Numerical Methods in Fluid Dynamics</title>
		<imprint>
			<biblScope unit="volume">II</biblScope>
			<date type="published" when="1986">1986</date>
			<publisher>Oxford University Press</publisher>
			<pubPlace>Oxford</pubPlace>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b14">
	<analytic>
		<title level="a" type="main">Mathematical balancing of flux gradient and source terms prior to using Roes approximate Riemann solver</title>
		<author>
			<persName><forename type="first">B</forename><forename type="middle">D</forename><surname>Rogers</surname></persName>
		</author>
		<author>
			<persName><forename type="first">A</forename><forename type="middle">G L</forename><surname>Borthwick</surname></persName>
		</author>
		<author>
			<persName><forename type="first">P</forename><forename type="middle">H</forename><surname>Taylor</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">168</biblScope>
			<biblScope unit="page" from="422" to="451" />
			<date type="published" when="2003">2003</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b15">
	<analytic>
		<title level="a" type="main">Generalized Roe schemes for 1D two-phase, free-surface flows over a mobile bed</title>
		<author>
			<persName><forename type="first">G</forename><surname>Rosatti</surname></persName>
		</author>
		<author>
			<persName><forename type="first">J</forename><surname>Murillo</surname></persName>
		</author>
		<author>
			<persName><forename type="first">L</forename><surname>Fraccarollo</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">54</biblScope>
			<biblScope unit="page" from="543" to="590" />
			<date type="published" when="2007">2007</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b16">
	<analytic>
		<title level="a" type="main">Some exact solutions to the nonlinear shallow water equations</title>
		<author>
			<persName><forename type="first">W</forename><forename type="middle">C</forename><surname>Thacker</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Fluid Mech</title>
		<imprint>
			<biblScope unit="volume">107</biblScope>
			<biblScope unit="page" from="499" to="508" />
			<date type="published" when="1981">1981</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b17">
	<monogr>
		<author>
			<persName><forename type="first">E</forename><forename type="middle">F</forename><surname>Toro</surname></persName>
		</author>
		<title level="m">Riemann Solvers and Numerical Methods for Fluid Dynamics</title>
		<meeting><address><addrLine>Berlin</addrLine></address></meeting>
		<imprint>
			<publisher>Springer</publisher>
			<date type="published" when="1997">1997</date>
			<biblScope unit="page">526</biblScope>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b18">
	<monogr>
		<author>
			<persName><forename type="first">E</forename><forename type="middle">F</forename><surname>Toro</surname></persName>
		</author>
		<title level="m">Shock-Capturing Methods for Free-Surface Shallow Flows</title>
		<meeting><address><addrLine>New York</addrLine></address></meeting>
		<imprint>
			<publisher>Wiley</publisher>
			<date type="published" when="2001">2001</date>
			<biblScope unit="page">109</biblScope>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b19">
	<analytic>
		<title level="a" type="main">Improved treatment of source terms in upwind schemes for the shallow water equations in channels with irregular geometry</title>
		<author>
			<persName><forename type="first">M</forename><forename type="middle">E</forename><surname>Vázquez-Cendón</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">148</biblScope>
			<biblScope unit="page" from="497" to="498" />
			<date type="published" when="1999">1999</date>
		</imprint>
	</monogr>
</biblStruct>

<biblStruct xml:id="b20">
	<analytic>
		<title level="a" type="main">The surface gradient method for the treatment of source terms in the shallow-water equations</title>
		<author>
			<persName><forename type="first">J</forename><forename type="middle">G</forename><surname>Zhou</surname></persName>
		</author>
		<author>
			<persName><forename type="first">D</forename><forename type="middle">M</forename><surname>Causon</surname></persName>
		</author>
		<author>
			<persName><forename type="first">C</forename><forename type="middle">G</forename><surname>Mingham</surname></persName>
		</author>
		<author>
			<persName><forename type="first">D</forename><forename type="middle">M</forename><surname>Ingram</surname></persName>
		</author>
	</analytic>
	<monogr>
		<title level="j">J. Comput. Phys</title>
		<imprint>
			<biblScope unit="volume">168</biblScope>
			<biblScope unit="page" from="1" to="25" />
			<date type="published" when="2001">2001</date>
		</imprint>
	</monogr>
</biblStruct>

				</listBibl>
			</div>
		</back>
	</text>
</TEI>
